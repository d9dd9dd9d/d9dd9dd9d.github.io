

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tone detection with Goertzel &mdash; Musicdsp.org  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tone detection with Goertzel (x86 ASM)" href="172-tone-detection-with-goertzel-x86-asm.html" />
    <link rel="prev" title="Simple peak follower" href="19-simple-peak-follower.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Musicdsp.org
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Analysis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="200-beat-detector-class.html">Beat Detector Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-coefficients-for-daubechies-wavelets-1-38.html">Coefficients for Daubechies wavelets 1-38</a></li>
<li class="toctree-l2"><a class="reference internal" href="21-dft.html">DFT</a></li>
<li class="toctree-l2"><a class="reference internal" href="97-envelope-detector.html">Envelope detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="136-envelope-follower-with-different-attack-and-release.html">Envelope follower with different attack and release</a></li>
<li class="toctree-l2"><a class="reference internal" href="79-fft.html">FFT</a></li>
<li class="toctree-l2"><a class="reference internal" href="82-fft-classes-in-c-and-object-pascal.html">FFT classes in C++ and Object Pascal</a></li>
<li class="toctree-l2"><a class="reference internal" href="18-fast-in-place-walsh-hadamard-transform.html">Fast in-place Walsh-Hadamard Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="186-frequency-response-from-biquad-coefficients.html">Frequency response from biquad coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="156-java-fft.html">Java FFT</a></li>
<li class="toctree-l2"><a class="reference internal" href="137-lpc-analysis-autocorrelation-levinson-durbin-recursion.html">LPC analysis (autocorrelation + Levinson-Durbin recursion)</a></li>
<li class="toctree-l2"><a class="reference internal" href="53-look-ahead-limiting.html">Look ahead limiting</a></li>
<li class="toctree-l2"><a class="reference internal" href="108-magnitude-and-phase-plot-of-arbitrary-iir-function-up-to-5th-order.html">Magnitude and phase plot of arbitrary IIR function, up to 5th order</a></li>
<li class="toctree-l2"><a class="reference internal" href="22-measuring-interpollation-noise.html">Measuring interpollation noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="146-qft-and-dqft-double-precision-classes.html">QFT and DQFT (double precision) classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="19-simple-peak-follower.html">Simple peak follower</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tone detection with Goertzel</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="172-tone-detection-with-goertzel-x86-asm.html">Tone detection with Goertzel (x86 ASM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="264-vintage-vu-meters-tutorial.html">Vintage VU meters tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Filters/index.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Musicdsp.org</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Analysis</a> &raquo;</li>
        
      <li>Tone detection with Goertzel</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Analysis/107-tone-detection-with-goertzel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tone-detection-with-goertzel">
<h1>Tone detection with Goertzel<a class="headerlink" href="#tone-detection-with-goertzel" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> <a class="reference external" href="mailto:on&#46;biu&#46;ii&#37;&#52;&#48;rnepse">on<span>&#46;</span>biu<span>&#46;</span>ii<span>&#64;</span>rnepse</a></p></li>
<li><p><strong>Type:</strong> Goertzel</p></li>
<li><p><strong>Created:</strong> 2004-04-07 09:37:10</p></li>
<li><p><strong>Linked files:</strong> <a class="reference download external" download="" href="../files/http://www.ii.uib.no/~espenr/tonedetect.zip"><code class="xref download docutils literal notranslate"><span class="pre">http://www.ii.uib.no/~espenr/tonedetect.zip</span></code></a>.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Goertzel is basically DFT of parts of a spectrum not the total spectrum as you normally do
with FFT. So if you just want to check out the power for some frequencies this could be
better. Is good for DTFM detection I&#39;ve heard.

The WNk isn&#39;t calculated 100% correctly, but it seems to work so ;) Yeah and the code is
C++ so you might have to do some small adjustment to compile it as C.
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/** Tone detect by Goertzel algorithm</span>
<span class="cm"> *</span>
<span class="cm"> * This program basically searches for tones (sines) in a sample and reports the different dB it finds for</span>
<span class="cm"> * different frequencies. Can easily be extended with some thresholding to report true/false on detection.</span>
<span class="cm"> * I&#39;m far from certain goertzel it implemented 100% correct, but it works :)</span>
<span class="cm"> *</span>
<span class="cm"> * Hint, the SAMPLERATE, BUFFERSIZE, FREQUENCY, NOISE and SIGNALVOLUME all affects the outcome of the reported dB. Tweak</span>
<span class="cm"> * em to find the settings best for your application. Also, seems to be pretty sensitive to noise (whitenoise anyway) which</span>
<span class="cm"> * is a bit sad. Also I don&#39;t know if the goertzel really likes float values for the frequency ... And using 44100 as</span>
<span class="cm"> * samplerate for detecting 6000 Hz tone is kinda silly I know :)</span>
<span class="cm"> *</span>
<span class="cm"> * Written by: Espen Riskedal, espenr@ii.uib.no, july-2002</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">rand</span><span class="p">;</span>
<span class="c1">// math stuff</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">exp</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">log10</span><span class="p">;</span>
<span class="c1">// iostream stuff</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="cp">#define PI 3.14159265358979323844</span>
<span class="c1">// change the defines if you want to</span>
<span class="cp">#define SAMPLERATE 44100</span>
<span class="cp">#define BUFFERSIZE 8820</span>
<span class="cp">#define FREQUENCY 6000</span>
<span class="cp">#define NOISE 0.05</span>
<span class="cp">#define SIGNALVOLUME 0.8</span>

<span class="cm">/**  The Goertzel algorithm computes the k-th DFT coefficient of the input signal using a second-order filter.</span>
<span class="cm"> *   http://ptolemy.eecs.berkeley.edu/papers/96/dtmf_ict/www/node3.html.</span>
<span class="cm"> *   Basiclly it just does a DFT of the frequency we want to check, and none of the others (FFT calculates for all frequencies).</span>
<span class="cm"> */</span>
<span class="kt">float</span> <span class="nf">goertzel</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">float</span> <span class="n">frequency</span><span class="p">,</span> <span class="kt">int</span> <span class="n">samplerate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">Skn</span><span class="p">,</span> <span class="n">Skn1</span><span class="p">,</span> <span class="n">Skn2</span><span class="p">;</span>
    <span class="n">Skn</span> <span class="o">=</span> <span class="n">Skn1</span> <span class="o">=</span> <span class="n">Skn2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Skn2</span> <span class="o">=</span> <span class="n">Skn1</span><span class="p">;</span>
    <span class="n">Skn1</span> <span class="o">=</span> <span class="n">Skn</span><span class="p">;</span>
    <span class="n">Skn</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">frequency</span><span class="o">/</span><span class="n">samplerate</span><span class="p">)</span><span class="o">*</span><span class="n">Skn1</span> <span class="o">-</span> <span class="n">Skn2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">float</span> <span class="n">WNk</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">frequency</span><span class="o">/</span><span class="n">samplerate</span><span class="p">);</span> <span class="c1">// this one ignores complex stuff</span>
    <span class="c1">//float WNk = exp(-2*j*PI*k/N);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Skn</span> <span class="o">-</span> <span class="n">WNk</span><span class="o">*</span><span class="n">Skn1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/** Generates a tone of the specified frequency</span>
<span class="cm"> *  Gotten from: http://groups.google.com/groups?hl=en&amp;lr=&amp;ie=UTF-8&amp;oe=UTF-8&amp;safe=off&amp;selm=3c641e%243jn%40uicsl.csl.uiuc.edu</span>
<span class="cm"> */</span>
<span class="kt">float</span> <span class="o">*</span><span class="nf">makeTone</span><span class="p">(</span><span class="kt">int</span> <span class="n">samplerate</span><span class="p">,</span> <span class="kt">float</span> <span class="n">frequency</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="kt">float</span> <span class="n">gain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//y(n) = 2 * cos(A) * y(n-1) - y(n-2)</span>
    <span class="c1">//A= (frequency of interest) * 2 * PI / (sampling frequency)</span>
    <span class="c1">//A is in radians.</span>
    <span class="c1">// frequency of interest MUST be &lt;= 1/2 the sampling frequency.</span>
    <span class="kt">float</span> <span class="o">*</span><span class="n">tone</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">float</span><span class="p">[</span><span class="n">length</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">A</span> <span class="o">=</span> <span class="n">frequency</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">/</span><span class="n">samplerate</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">];</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">));</span>
    <span class="k">else</span> <span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tone</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">gain</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">tone</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** adds whitenoise to a sample */</span>
<span class="kt">void</span> <span class="o">*</span><span class="nf">addNoise</span><span class="p">(</span><span class="kt">float</span> <span class="o">*</span><span class="n">sample</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="kt">float</span> <span class="n">gain</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">rand</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">RAND_MAX</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">gain</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** returns the signal power/dB */</span>
<span class="kt">float</span> <span class="nf">power</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Samplerate: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">SAMPLERATE</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Buffersize: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">BUFFERSIZE</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; samples</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Correct frequency is: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">FREQUENCY</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; - signal volume: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">SIGNALVOLUME</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;%</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; - white noise: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">NOISE</span><span class="o">*</span><span class="mi">100</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;%</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

    <span class="kt">float</span> <span class="o">*</span><span class="n">tone</span> <span class="o">=</span> <span class="n">makeTone</span><span class="p">(</span><span class="n">SAMPLERATE</span><span class="p">,</span> <span class="n">FREQUENCY</span><span class="p">,</span> <span class="n">BUFFERSIZE</span><span class="p">,</span> <span class="n">SIGNALVOLUME</span><span class="p">);</span>
    <span class="n">addNoise</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="n">BUFFERSIZE</span><span class="p">,</span><span class="n">NOISE</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">stepsize</span> <span class="o">=</span> <span class="n">FREQUENCY</span><span class="o">/</span><span class="mi">5</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="n">stepsize</span><span class="o">*</span><span class="n">i</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Trying freq: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">freq</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hz  -&gt;  dB: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">power</span><span class="p">(</span><span class="n">goertzel</span><span class="p">(</span><span class="n">tone</span><span class="p">,</span> <span class="n">BUFFERSIZE</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">SAMPLERATE</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="n">tone</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2004-04-12 22:03:56</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ed&#46;luosfosruoivas&#37;&#52;&#48;naitsirhC">ed<span>&#46;</span>luosfosruoivas<span>&#64;</span>naitsirhC</a></p></li>
</ul>
<div class="highlight-delphi notranslate"><div class="highlight"><pre><span></span><span class="c1">// yet untested Delphi translation of the algorithm:</span>

<span class="k">function</span> <span class="nf">Goertzel</span><span class="p">(</span><span class="n">Buffer</span><span class="o">:</span><span class="k">array</span> <span class="k">of</span> <span class="kt">Single</span><span class="o">;</span> <span class="n">frequency</span><span class="o">,</span> <span class="n">samplerate</span><span class="o">:</span> <span class="kt">single</span><span class="p">)</span><span class="o">:</span><span class="kt">single</span><span class="o">;</span>
<span class="k">var</span> <span class="n">Skn</span><span class="o">,</span> <span class="n">Skn1</span><span class="o">,</span> <span class="n">Skn2</span> <span class="o">:</span> <span class="kt">Single</span><span class="o">;</span>
    <span class="n">i</span>               <span class="o">:</span> <span class="kt">Integer</span><span class="o">;</span>
    <span class="n">temp1</span><span class="o">,</span> <span class="n">temp2</span>    <span class="o">:</span> <span class="kt">Single</span><span class="o">;</span>
<span class="k">begin</span>
 <span class="n">skn</span><span class="o">:=</span><span class="mi">0</span><span class="o">;</span>
 <span class="n">skn1</span><span class="o">:=</span><span class="mi">0</span><span class="o">;</span>
 <span class="n">skn2</span><span class="o">:=</span><span class="mi">0</span><span class="o">;</span>
 <span class="n">temp1</span><span class="o">:=</span><span class="mi">2</span><span class="o">*</span><span class="nb">PI</span><span class="o">*</span><span class="n">frequency</span><span class="o">/</span><span class="n">samplerate</span><span class="o">;</span>
 <span class="n">temp2</span><span class="o">:=</span><span class="nb">Cos</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span><span class="o">;</span>
 <span class="k">for</span> <span class="n">i</span><span class="o">:=</span><span class="mi">0</span> <span class="k">to</span> <span class="nb">Length</span><span class="p">(</span><span class="n">Buffer</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">begin</span>
   <span class="n">Skn2</span> <span class="o">=</span> <span class="n">Skn1</span><span class="o">;</span>
   <span class="n">Skn1</span> <span class="o">=</span> <span class="n">Skn</span><span class="o">;</span>
   <span class="n">Skn</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">temp2</span><span class="o">*</span><span class="n">Skn1</span> <span class="o">-</span> <span class="n">Skn2</span> <span class="o">+</span> <span class="n">Buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">;</span>
  <span class="k">end</span><span class="o">;</span>
 <span class="bp">Result</span><span class="o">:=</span><span class="p">(</span><span class="n">Skn</span> <span class="o">-</span> <span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp1</span><span class="p">)</span><span class="o">*</span><span class="n">Skn1</span><span class="p">)</span><span class="o">;</span>
<span class="k">end</span><span class="o">;</span>

<span class="c1">// Maybe someone can use it...</span>
<span class="c1">//</span>
<span class="c1">// Christian</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="172-tone-detection-with-goertzel-x86-asm.html" class="btn btn-neutral float-right" title="Tone detection with Goertzel (x86 ASM)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="19-simple-peak-follower.html" class="btn btn-neutral float-left" title="Simple peak follower" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>