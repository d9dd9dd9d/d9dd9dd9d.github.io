

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Simple peak follower &mdash; Mark&#39;s Notebook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tone detection with Goertzel" href="107-tone-detection-with-goertzel.html" />
    <link rel="prev" title="QFT and DQFT (double precision) classes" href="146-qft-and-dqft-double-precision-classes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Mark's Notebook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Analysis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="200-beat-detector-class.html">Beat Detector Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="20-coefficients-for-daubechies-wavelets-1-38.html">Coefficients for Daubechies wavelets 1-38</a></li>
<li class="toctree-l2"><a class="reference internal" href="21-dft.html">DFT</a></li>
<li class="toctree-l2"><a class="reference internal" href="97-envelope-detector.html">Envelope detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="136-envelope-follower-with-different-attack-and-release.html">Envelope follower with different attack and release</a></li>
<li class="toctree-l2"><a class="reference internal" href="79-fft.html">FFT</a></li>
<li class="toctree-l2"><a class="reference internal" href="82-fft-classes-in-c-and-object-pascal.html">FFT classes in C++ and Object Pascal</a></li>
<li class="toctree-l2"><a class="reference internal" href="18-fast-in-place-walsh-hadamard-transform.html">Fast in-place Walsh-Hadamard Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="186-frequency-response-from-biquad-coefficients.html">Frequency response from biquad coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="156-java-fft.html">Java FFT</a></li>
<li class="toctree-l2"><a class="reference internal" href="137-lpc-analysis-autocorrelation-levinson-durbin-recursion.html">LPC analysis (autocorrelation + Levinson-Durbin recursion)</a></li>
<li class="toctree-l2"><a class="reference internal" href="53-look-ahead-limiting.html">Look ahead limiting</a></li>
<li class="toctree-l2"><a class="reference internal" href="108-magnitude-and-phase-plot-of-arbitrary-iir-function-up-to-5th-order.html">Magnitude and phase plot of arbitrary IIR function, up to 5th order</a></li>
<li class="toctree-l2"><a class="reference internal" href="22-measuring-interpollation-noise.html">Measuring interpollation noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="146-qft-and-dqft-double-precision-classes.html">QFT and DQFT (double precision) classes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Simple peak follower</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="107-tone-detection-with-goertzel.html">Tone detection with Goertzel</a></li>
<li class="toctree-l2"><a class="reference internal" href="172-tone-detection-with-goertzel-x86-asm.html">Tone detection with Goertzel (x86 ASM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="264-vintage-vu-meters-tutorial.html">Vintage VU meters tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../test/index.html">test</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mark's Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Analysis</a> &raquo;</li>
        
      <li>Simple peak follower</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/d9dd9dd9d/d9dd9dd9d.github.io/blob/master/source/Analysis/19-simple-peak-follower.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="simple-peak-follower">
<h1>Simple peak follower<a class="headerlink" href="#simple-peak-follower" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> Phil Burk</p></li>
<li><p><strong>Type:</strong> amplitude analysis</p></li>
<li><p><strong>Created:</strong> 2002-01-17 01:57:19</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This simple peak follower will give track the peaks of a signal. It will rise rapidly when
the input is rising, and then decay exponentially when the input drops. It can be used to
drive VU meters, or used in an automatic gain control circuit.
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// halfLife = time in seconds for output to decay to half value after an impulse</span>

<span class="k">static</span> <span class="kt">float</span> <span class="n">output</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">scalar</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">halfLife</span> <span class="o">*</span> <span class="n">sampleRate</span><span class="p">)));</span>

<span class="k">if</span><span class="p">(</span> <span class="n">input</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="p">)</span>
  <span class="n">input</span> <span class="o">=</span> <span class="o">-</span><span class="n">input</span><span class="p">;</span>  <span class="cm">/* Absolute value. */</span>

<span class="k">if</span> <span class="p">(</span> <span class="n">input</span> <span class="o">&gt;=</span> <span class="n">output</span> <span class="p">)</span>
<span class="p">{</span>
   <span class="cm">/* When we hit a peak, ride the peak to the top. */</span>
   <span class="n">output</span> <span class="o">=</span> <span class="n">input</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
   <span class="cm">/* Exponential decay of output when signal is low. */</span>
   <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">*</span> <span class="n">scalar</span><span class="p">;</span>
   <span class="cm">/*</span>
<span class="cm">   ** When current gets close to 0.0, set current to 0.0 to prevent FP underflow</span>
<span class="cm">   ** which can cause a severe performance degradation due to a flood</span>
<span class="cm">   ** of interrupts.</span>
<span class="cm">   */</span>
   <span class="k">if</span><span class="p">(</span> <span class="n">output</span> <span class="o">&lt;</span> <span class="n">VERY_SMALL_FLOAT</span> <span class="p">)</span> <span class="n">output</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-01-26 09:48:15</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;osoromaerfac">moc<span>&#46;</span>liamg<span>&#64;</span>osoromaerfac</a></p></li>
</ul>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef VERY_SMALL_FLOAT</span>
<span class="cp">#define VERY_SMALL_FLOAT 1.0e-30F</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="107-tone-detection-with-goertzel.html" class="btn btn-neutral float-right" title="Tone detection with Goertzel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="146-qft-and-dqft-double-precision-classes.html" class="btn btn-neutral float-left" title="QFT and DQFT (double precision) classes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Mark&#39;s Notebook

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>