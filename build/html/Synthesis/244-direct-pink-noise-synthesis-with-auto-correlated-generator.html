

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Direct pink noise synthesis with auto-correlated generator &mdash; Notebook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Discrete Summation Formula (DSF)" href="68-discrete-summation-formula-dsf.html" />
    <link rel="prev" title="DSF (super-set of BLIT)" href="140-dsf-super-set-of-blit.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Notebook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Synthesis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="16-allmost-ready-to-use-oscillators.html">(Allmost) Ready-to-use oscillators</a></li>
<li class="toctree-l2"><a class="reference internal" href="224-am-formantic-synthesis.html">AM Formantic Synthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="1-alias-free-waveform-generation-with-analog-filtering.html">Alias-free waveform generation with analog filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="152-another-lfo-class.html">Another LFO class</a></li>
<li class="toctree-l2"><a class="reference internal" href="167-another-cheap-sinusoidal-lfo.html">Another cheap sinusoidal LFO</a></li>
<li class="toctree-l2"><a class="reference internal" href="219-antialiased-square-generator.html">Antialiased square generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="134-arbitary-shaped-band-limited-waveform-generation-using-oversampling-and-low-pass-filtering.html">Arbitary shaped band-limited waveform generation (using oversampling and low-pass filtering)</a></li>
<li class="toctree-l2"><a class="reference internal" href="123-audiable-alias-free-waveform-gen-using-width-sine.html">Audiable alias free waveform gen using width sine</a></li>
<li class="toctree-l2"><a class="reference internal" href="268-band-limited-waveforms-my-way.html">Band Limited waveforms my way</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-bandlimited-sawtooth-synthesis.html">Bandlimited sawtooth synthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="17-bandlimited-waveform-generation.html">Bandlimited waveform generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="75-bandlimited-waveforms-synopsis.html">Bandlimited waveforms synopsis.</a></li>
<li class="toctree-l2"><a class="reference internal" href="12-bandlimited-waveforms.html">Bandlimited waveforms…</a></li>
<li class="toctree-l2"><a class="reference internal" href="227-butterworth.html">Butterworth</a></li>
<li class="toctree-l2"><a class="reference internal" href="239-c-oscilator-class.html">C# Oscilator class</a></li>
<li class="toctree-l2"><a class="reference internal" href="168-c-gaussian-noise-generation.html">C++ gaussian noise generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="187-chebyshev-waveshaper-using-their-recursive-definition.html">Chebyshev waveshaper (using their recursive definition)</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-cubic-polynomial-envelopes.html">Cubic polynomial envelopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="140-dsf-super-set-of-blit.html">DSF (super-set of BLIT)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Direct pink noise synthesis with auto-correlated generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="68-discrete-summation-formula-dsf.html">Discrete Summation Formula (DSF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="183-drift-generator.html">Drift generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="217-easy-noise-generation.html">Easy noise generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="189-fast-exponential-envelope-generator.html">Fast Exponential Envelope Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="151-fast-lfo-in-delphi.html">Fast LFO in Delphi…</a></li>
<li class="toctree-l2"><a class="reference internal" href="261-fast-sin-approximation-for-usage-in-e-g-additive-synthesizers.html">Fast SIN approximation for usage in e.g. additive synthesizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="216-fast-whitenoise-generator.html">Fast Whitenoise Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-fast-sine-and-cosine-calculation.html">Fast sine and cosine calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="9-fast-sine-wave-calculation.html">Fast sine wave calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="69-fast-square-wave-generator.html">Fast square wave generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="113-gaussian-white-noise.html">Gaussian White Noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="109-gaussian-white-noise.html">Gaussian White noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="215-generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="14-inverted-parabolic-envelope.html">Inverted parabolic envelope</a></li>
<li class="toctree-l2"><a class="reference internal" href="211-matlab-octave-code-for-minblep-table-generation.html">Matlab/octave code for minblep table generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="213-padsynth-synthesys-method.html">PADsynth synthesys method</a></li>
<li class="toctree-l2"><a class="reference internal" href="271-prng-for-non-uniformly-distributed-values-from-trigonometric-identity.html">PRNG for non-uniformly distributed values from trigonometric identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="254-parabolic-shaper.html">Parabolic shaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="111-phase-modulation-vs-frequency-modulation.html">Phase modulation Vs. Frequency modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="160-phase-modulation-vs-frequency-modulation-ii.html">Phase modulation Vs. Frequency modulation II</a></li>
<li class="toctree-l2"><a class="reference internal" href="59-pseudo-random-generator.html">Pseudo-Random generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="242-pulsequad.html">PulseQuad</a></li>
<li class="toctree-l2"><a class="reference internal" href="8-pulsewidth-modulation.html">Pulsewidth modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="241-quick-dirty-sine.html">Quick &amp; Dirty Sine</a></li>
<li class="toctree-l2"><a class="reference internal" href="161-quick-and-dirty-sine-generator.html">Quick and dirty sine generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="199-rbj-wavetable-101.html">RBJ Wavetable 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="272-randja-compressor.html">Randja compressor</a></li>
<li class="toctree-l2"><a class="reference internal" href="184-rossler-and-lorenz-oscillators.html">Rossler and Lorenz Oscillators</a></li>
<li class="toctree-l2"><a class="reference internal" href="67-sawsin.html">SawSin</a></li>
<li class="toctree-l2"><a class="reference internal" href="262-simple-time-stretching-granular-synthesizer.html">Simple Time Stretching-Granular Synthesizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="13-sine-calculation.html">Sine calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="269-smooth-random-lfo-generator.html">Smooth random LFO Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-square-waves.html">Square Waves</a></li>
<li class="toctree-l2"><a class="reference internal" href="220-trammell-pink-noise-c-class.html">Trammell Pink Noise (C++ class)</a></li>
<li class="toctree-l2"><a class="reference internal" href="112-waveform-generator-using-minbleps.html">Waveform generator using MinBLEPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="80-wavetable-synthesis.html">Wavetable Synthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="11-weird-synthesis.html">Weird synthesis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filters/index.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Synthesis</a> &raquo;</li>
        
      <li>Direct pink noise synthesis with auto-correlated generator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="direct-pink-noise-synthesis-with-auto-correlated-generator">
<h1>Direct pink noise synthesis with auto-correlated generator<a class="headerlink" href="#direct-pink-noise-synthesis-with-auto-correlated-generator" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> RidgeRat &lt;<a class="reference external" href="mailto:ten&#46;knilhtrae&#37;&#52;&#48;6741emmartl">ten<span>&#46;</span>knilhtrae<span>&#64;</span>6741emmartl</a>&gt;</p></li>
<li><p><strong>Type:</strong> 16-bit fixed-point</p></li>
<li><p><strong>Created:</strong> 2007-02-11 20:15:42</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Canonical C++ class with minimum system dependencies, BUT you must provide your own
uniform random number generator. Accurate range is a little over 9 octaves, degrading
gracefully beyond this. Estimated deviations +-0.25 dB from ideal 1/f curve in range.
Scaled to fit signed 16-bit range.
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Pink noise class using the autocorrelated generator method.</span>
<span class="c1">// Method proposed and described by Larry Trammell &quot;the RidgeRat&quot; --</span>
<span class="c1">// see http://home.earthlink.net/~ltrammell/tech/newpink.htm</span>
<span class="c1">// There are no restrictions.</span>
<span class="c1">//</span>
<span class="c1">// ------------------------------------------------------------------</span>
<span class="c1">//</span>
<span class="c1">// This is a canonical, 16-bit fixed-point implementation of the</span>
<span class="c1">// generator in 32-bit arithmetic. There are only a few system</span>
<span class="c1">// dependencies.</span>
<span class="c1">//</span>
<span class="c1">//   -- access to an allocator &#39;malloc&#39; for operator new</span>
<span class="c1">//   -- access to definition of &#39;size_t&#39;</span>
<span class="c1">//   -- assumes 32-bit two&#39;s complement arithmetic</span>
<span class="c1">//   -- assumes long int is 32 bits, short int is 16 bits</span>
<span class="c1">//   -- assumes that signed right shift propagates the sign bit</span>
<span class="c1">//</span>
<span class="c1">// It needs a separate URand class to provide uniform 16-bit random</span>
<span class="c1">// numbers on interval [1,65535]. The assumed class must provide</span>
<span class="c1">// methods to query and set the current seed value, establish a</span>
<span class="c1">// scrambled initial seed value, and evaluate uniform random values.</span>
<span class="c1">//</span>
<span class="c1">//</span>
<span class="c1">// ----------- header -----------------------------------------------</span>
<span class="c1">// pinkgen.h</span>

<span class="cp">#ifndef  _pinkgen_h_</span>
<span class="cp">#define  _pinkgen_h_  1</span>

<span class="cp">#include</span>  <span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span>  <span class="cpf">&lt;alloc.h&gt;</span><span class="cp"></span>

<span class="c1">// You must provide the uniform random generator class.</span>
<span class="cp">#ifndef  _URand_h_</span>
<span class="cp">#include</span>  <span class="cpf">&quot;URand.h&quot;</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="k">class</span> <span class="nc">PinkNoise</span> <span class="p">{</span>
  <span class="k">private</span><span class="o">:</span>
    <span class="c1">// Coefficients (fixed)</span>
    <span class="k">static</span> <span class="kt">long</span> <span class="kt">int</span> <span class="k">const</span> <span class="n">pA</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="k">static</span> <span class="kt">short</span> <span class="kt">int</span> <span class="k">const</span> <span class="n">pPSUM</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

    <span class="c1">// Internal pink generator state</span>
    <span class="kt">long</span> <span class="kt">int</span>   <span class="n">contrib</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>   <span class="c1">// stage contributions</span>
    <span class="kt">long</span> <span class="kt">int</span>   <span class="n">accum</span><span class="p">;</span>        <span class="c1">// combined generators</span>
    <span class="kt">void</span>       <span class="nf">internal_clear</span><span class="p">(</span> <span class="p">);</span>

    <span class="c1">// Include a UNoise component</span>
    <span class="n">URand</span>     <span class="n">ugen</span><span class="p">;</span>

  <span class="k">public</span><span class="o">:</span>
    <span class="n">PinkNoise</span><span class="p">(</span> <span class="p">);</span>
    <span class="n">PinkNoise</span><span class="p">(</span> <span class="n">PinkNoise</span> <span class="o">&amp;</span> <span class="p">);</span>
    <span class="o">~</span><span class="n">PinkNoise</span><span class="p">(</span> <span class="p">);</span>
    <span class="kt">void</span> <span class="o">*</span>  <span class="k">operator</span> <span class="nf">new</span><span class="p">(</span> <span class="kt">size_t</span> <span class="p">);</span>
    <span class="kt">void</span>  <span class="nf">pinkclear</span><span class="p">(</span> <span class="p">);</span>
    <span class="kt">short</span> <span class="kt">int</span>  <span class="nf">pinkrand</span><span class="p">(</span> <span class="p">);</span>
<span class="p">}</span> <span class="p">;</span>
<span class="cp">#endif</span>

<span class="c1">// ----------- implementation ---------------------------------------</span>
<span class="c1">// pinkgen.cpp</span>

<span class="cp">#include</span>  <span class="cpf">&quot;pinkgen.h&quot;</span><span class="cp"></span>

<span class="c1">// Static class data</span>
<span class="kt">long</span> <span class="kt">int</span> <span class="k">const</span> <span class="n">PinkNoise</span><span class="o">::</span><span class="n">pA</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>
    <span class="p">{</span> <span class="mi">14055</span><span class="p">,</span> <span class="mi">12759</span><span class="p">,</span> <span class="mi">10733</span><span class="p">,</span> <span class="mi">12273</span><span class="p">,</span> <span class="mi">15716</span> <span class="p">};</span>
<span class="kt">short</span> <span class="kt">int</span> <span class="k">const</span> <span class="n">PinkNoise</span><span class="o">::</span><span class="n">pPSUM</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>
    <span class="p">{</span> <span class="mi">22347</span><span class="p">,</span> <span class="mi">27917</span><span class="p">,</span> <span class="mi">29523</span><span class="p">,</span> <span class="mi">29942</span><span class="p">,</span> <span class="mi">30007</span> <span class="p">};</span>

<span class="c1">// Clear generator to a zero state.</span>
<span class="kt">void</span>   <span class="n">PinkNoise</span><span class="o">::</span><span class="n">pinkclear</span><span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>  <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span>  <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="p">{</span> <span class="n">contrib</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0L</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">accum</span> <span class="o">=</span> <span class="mi">0L</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// PRIVATE, clear generator and also scramble the internal</span>
<span class="c1">// uniform generator seed.</span>
<span class="kt">void</span>   <span class="n">PinkNoise</span><span class="o">::</span><span class="n">internal_clear</span><span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pinkclear</span><span class="p">();</span>
    <span class="n">ugen</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>    <span class="c1">// Randomizes the seed!</span>
<span class="p">}</span>

<span class="c1">// Constructor. Guarantee that initial state is cleared</span>
<span class="c1">// and uniform generator scrambled.</span>
<span class="n">PinkNoise</span><span class="o">::</span><span class="n">PinkNoise</span><span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">internal_clear</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Copy constructor. Preserve generator state from the source</span>
<span class="c1">// object, including the uniform generator seed.</span>
<span class="n">PinkNoise</span><span class="o">::</span><span class="n">PinkNoise</span><span class="p">(</span> <span class="n">PinkNoise</span> <span class="o">&amp;</span> <span class="n">Source</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>  <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="n">contrib</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">Source</span><span class="p">.</span><span class="n">contrib</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">accum</span> <span class="o">=</span> <span class="n">Source</span><span class="p">.</span><span class="n">accum</span><span class="p">;</span>
    <span class="n">ugen</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span> <span class="n">Source</span><span class="p">.</span><span class="n">ugen</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span> <span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Operator new. Just fetch required object storage.</span>
<span class="kt">void</span> <span class="o">*</span>   <span class="n">PinkNoise</span><span class="o">::</span><span class="k">operator</span> <span class="k">new</span><span class="p">(</span> <span class="kt">size_t</span> <span class="n">size</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span>   <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Destructor. No special action required.</span>
<span class="n">PinkNoise</span><span class="o">::~</span><span class="n">PinkNoise</span><span class="p">(</span> <span class="p">)</span>  <span class="p">{</span> <span class="cm">/* NIL */</span> <span class="p">}</span>

<span class="c1">// Coding artifact for convenience</span>
<span class="cp">#define   UPDATE_CONTRIB(n)  \</span>
<span class="cp">     {                                   \</span>
<span class="cp">       accum -= contrib[n];              \</span>
<span class="cp">       contrib[n] = (long)randv * pA[n]; \</span>
<span class="cp">       accum += contrib[n];              \</span>
<span class="cp">       break;                            \</span>
<span class="cp">     }</span>

<span class="c1">// Evaluate next randomized &#39;pink&#39; number with uniform CPU loading.</span>
<span class="kt">short</span> <span class="kt">int</span>   <span class="n">PinkNoise</span><span class="o">::</span><span class="n">pinkrand</span><span class="p">(</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">short</span> <span class="kt">int</span>  <span class="n">randu</span> <span class="o">=</span> <span class="n">ugen</span><span class="p">.</span><span class="n">urand</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mh">0x7fff</span><span class="p">;</span>     <span class="c1">// U[0,32767]</span>
    <span class="kt">short</span> <span class="kt">int</span>  <span class="n">randv</span> <span class="o">=</span> <span class="p">(</span><span class="kt">short</span> <span class="kt">int</span><span class="p">)</span> <span class="n">ugen</span><span class="p">.</span><span class="n">urand</span><span class="p">();</span>  <span class="c1">// U[-32768,32767]</span>

    <span class="c1">// Structured block, at most one update is performed</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">randu</span> <span class="o">&lt;</span> <span class="n">pPSUM</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="n">UPDATE_CONTRIB</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">randu</span> <span class="o">&lt;</span> <span class="n">pPSUM</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="n">UPDATE_CONTRIB</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">randu</span> <span class="o">&lt;</span> <span class="n">pPSUM</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="n">UPDATE_CONTRIB</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">randu</span> <span class="o">&lt;</span> <span class="n">pPSUM</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="n">UPDATE_CONTRIB</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">randu</span> <span class="o">&lt;</span> <span class="n">pPSUM</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="n">UPDATE_CONTRIB</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">short</span> <span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accum</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ----------- application   -------------------------------</span>

<span class="kt">short</span> <span class="kt">int</span>    <span class="n">pink_signal</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

<span class="kt">void</span>   <span class="nf">example</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PinkNoise</span>    <span class="n">pinkgen</span><span class="p">;</span>
    <span class="kt">int</span>  <span class="n">i</span><span class="p">;</span>
    <span class="k">for</span>  <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">1024</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>   <span class="n">pink_signal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pinkgen</span><span class="p">.</span><span class="n">pinkrand</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="68-discrete-summation-formula-dsf.html" class="btn btn-neutral float-right" title="Discrete Summation Formula (DSF)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="140-dsf-super-set-of-blit.html" class="btn btn-neutral float-left" title="DSF (super-set of BLIT)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>