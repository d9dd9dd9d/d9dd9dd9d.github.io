

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>AM Formantic Synthesis &mdash; Musicdsp.org  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Alias-free waveform generation with analog filtering" href="1-alias-free-waveform-generation-with-analog-filtering.html" />
    <link rel="prev" title="(Allmost) Ready-to-use oscillators" href="16-allmost-ready-to-use-oscillators.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Musicdsp.org
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Synthesis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="16-allmost-ready-to-use-oscillators.html">(Allmost) Ready-to-use oscillators</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">AM Formantic Synthesis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="1-alias-free-waveform-generation-with-analog-filtering.html">Alias-free waveform generation with analog filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="152-another-lfo-class.html">Another LFO class</a></li>
<li class="toctree-l2"><a class="reference internal" href="167-another-cheap-sinusoidal-lfo.html">Another cheap sinusoidal LFO</a></li>
<li class="toctree-l2"><a class="reference internal" href="219-antialiased-square-generator.html">Antialiased square generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="134-arbitary-shaped-band-limited-waveform-generation-using-oversampling-and-low-pass-filtering.html">Arbitary shaped band-limited waveform generation (using oversampling and low-pass filtering)</a></li>
<li class="toctree-l2"><a class="reference internal" href="123-audiable-alias-free-waveform-gen-using-width-sine.html">Audiable alias free waveform gen using width sine</a></li>
<li class="toctree-l2"><a class="reference internal" href="268-band-limited-waveforms-my-way.html">Band Limited waveforms my way</a></li>
<li class="toctree-l2"><a class="reference internal" href="90-bandlimited-sawtooth-synthesis.html">Bandlimited sawtooth synthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="17-bandlimited-waveform-generation.html">Bandlimited waveform generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="75-bandlimited-waveforms-synopsis.html">Bandlimited waveforms synopsis.</a></li>
<li class="toctree-l2"><a class="reference internal" href="12-bandlimited-waveforms.html">Bandlimited waveforms…</a></li>
<li class="toctree-l2"><a class="reference internal" href="227-butterworth.html">Butterworth</a></li>
<li class="toctree-l2"><a class="reference internal" href="239-c-oscilator-class.html">C# Oscilator class</a></li>
<li class="toctree-l2"><a class="reference internal" href="168-c-gaussian-noise-generation.html">C++ gaussian noise generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="187-chebyshev-waveshaper-using-their-recursive-definition.html">Chebyshev waveshaper (using their recursive definition)</a></li>
<li class="toctree-l2"><a class="reference internal" href="15-cubic-polynomial-envelopes.html">Cubic polynomial envelopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="140-dsf-super-set-of-blit.html">DSF (super-set of BLIT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="244-direct-pink-noise-synthesis-with-auto-correlated-generator.html">Direct pink noise synthesis with auto-correlated generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="68-discrete-summation-formula-dsf.html">Discrete Summation Formula (DSF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="183-drift-generator.html">Drift generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="217-easy-noise-generation.html">Easy noise generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="189-fast-exponential-envelope-generator.html">Fast Exponential Envelope Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="151-fast-lfo-in-delphi.html">Fast LFO in Delphi…</a></li>
<li class="toctree-l2"><a class="reference internal" href="261-fast-sin-approximation-for-usage-in-e-g-additive-synthesizers.html">Fast SIN approximation for usage in e.g. additive synthesizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="216-fast-whitenoise-generator.html">Fast Whitenoise Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-fast-sine-and-cosine-calculation.html">Fast sine and cosine calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="9-fast-sine-wave-calculation.html">Fast sine wave calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="69-fast-square-wave-generator.html">Fast square wave generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="113-gaussian-white-noise.html">Gaussian White Noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="109-gaussian-white-noise.html">Gaussian White noise</a></li>
<li class="toctree-l2"><a class="reference internal" href="215-generator.html">Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="14-inverted-parabolic-envelope.html">Inverted parabolic envelope</a></li>
<li class="toctree-l2"><a class="reference internal" href="211-matlab-octave-code-for-minblep-table-generation.html">Matlab/octave code for minblep table generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="213-padsynth-synthesys-method.html">PADsynth synthesys method</a></li>
<li class="toctree-l2"><a class="reference internal" href="271-prng-for-non-uniformly-distributed-values-from-trigonometric-identity.html">PRNG for non-uniformly distributed values from trigonometric identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="254-parabolic-shaper.html">Parabolic shaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="111-phase-modulation-vs-frequency-modulation.html">Phase modulation Vs. Frequency modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="160-phase-modulation-vs-frequency-modulation-ii.html">Phase modulation Vs. Frequency modulation II</a></li>
<li class="toctree-l2"><a class="reference internal" href="59-pseudo-random-generator.html">Pseudo-Random generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="242-pulsequad.html">PulseQuad</a></li>
<li class="toctree-l2"><a class="reference internal" href="8-pulsewidth-modulation.html">Pulsewidth modulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="241-quick-dirty-sine.html">Quick &amp; Dirty Sine</a></li>
<li class="toctree-l2"><a class="reference internal" href="161-quick-and-dirty-sine-generator.html">Quick and dirty sine generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="199-rbj-wavetable-101.html">RBJ Wavetable 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="272-randja-compressor.html">Randja compressor</a></li>
<li class="toctree-l2"><a class="reference internal" href="184-rossler-and-lorenz-oscillators.html">Rossler and Lorenz Oscillators</a></li>
<li class="toctree-l2"><a class="reference internal" href="67-sawsin.html">SawSin</a></li>
<li class="toctree-l2"><a class="reference internal" href="262-simple-time-stretching-granular-synthesizer.html">Simple Time Stretching-Granular Synthesizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="13-sine-calculation.html">Sine calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="269-smooth-random-lfo-generator.html">Smooth random LFO Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-square-waves.html">Square Waves</a></li>
<li class="toctree-l2"><a class="reference internal" href="220-trammell-pink-noise-c-class.html">Trammell Pink Noise (C++ class)</a></li>
<li class="toctree-l2"><a class="reference internal" href="112-waveform-generator-using-minbleps.html">Waveform generator using MinBLEPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="80-wavetable-synthesis.html">Wavetable Synthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="11-weird-synthesis.html">Weird synthesis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filters/index.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Musicdsp.org</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Synthesis</a> &raquo;</li>
        
      <li>AM Formantic Synthesis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Synthesis/224-am-formantic-synthesis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="am-formantic-synthesis">
<h1>AM Formantic Synthesis<a class="headerlink" href="#am-formantic-synthesis" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> Paul Sernine</p></li>
<li><p><strong>Created:</strong> 2006-07-05 20:14:14</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Here is another tutorial from Doc Rochebois.
It performs formantic synthesis without filters and without grains. Instead, it uses
&quot;double carrier amplitude modulation&quot; to pitch shift formantic waveforms. Just beware the
phase relationships to avoid interferences. Some patches of the DX7 used the same trick
but phase interferences were a problem. Here, Thierry Rochebois avoids them by using
cosine-phased waveforms.

Various formantic waveforms are precalculated and put in tables, they correspond to
different formant widths.
The runtime uses many intances (here 4) of these and pitch shifts them with double
carriers (to preserve the harmonicity of the signal).

This is a tutorial code, it can be optimized in many ways.
Have Fun

Paul
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// FormantsAM.cpp</span>

<span class="c1">// Thierry Rochebois&#39; &quot;Formantic Synthesis by Double Amplitude Modulation&quot;</span>

<span class="c1">// Based on a tutorial by Thierry Rochebois.</span>
<span class="c1">// Comments by Paul Sernine.</span>

<span class="c1">// The spectral content of the signal is obtained by adding amplitude modulated formantic</span>
<span class="c1">// waveforms. The amplitude modulations spectraly shift the formantic waveforms.</span>
<span class="c1">// Continuous spectral shift, without losing the harmonic structure, is obtained</span>
<span class="c1">// by using crossfaded double carriers (multiple of the base frequency).</span>
<span class="c1">// To avoid  unwanted interference artifacts, phase relationships must be of the</span>
<span class="c1">// &quot;cosine type&quot;.</span>

<span class="c1">// The output is a 44100Hz 16bit stereo PCM file.</span>

<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="c1">//Approximates cos(pi*x) for x in [-1,1].</span>
<span class="kr">inline</span> <span class="kt">float</span> <span class="nf">fast_cos</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span> <span class="n">x2</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="n">x2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">x2</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Length of the table</span>
<span class="cp">#define L_TABLE (256+1) </span><span class="c1">//The last entry of the table equals the first (to avoid a modulo)</span>
<span class="c1">//Maximal formant width</span>
<span class="cp">#define I_MAX 64</span>
<span class="c1">//Table of formants</span>
<span class="kt">float</span> <span class="n">TF</span><span class="p">[</span><span class="n">L_TABLE</span><span class="o">*</span><span class="n">I_MAX</span><span class="p">];</span>

<span class="c1">//Formantic function of width I (used to fill the table of formants)</span>
<span class="kt">float</span> <span class="nf">fonc_formant</span><span class="p">(</span><span class="kt">float</span> <span class="n">p</span><span class="p">,</span><span class="k">const</span> <span class="kt">float</span> <span class="n">I</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.5f</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">hmax</span><span class="o">=</span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">&gt;</span><span class="n">L_TABLE</span><span class="o">/</span><span class="mi">2</span><span class="o">?</span><span class="n">L_TABLE</span><span class="o">/</span><span class="mi">2</span><span class="o">:</span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">I</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">phi</span><span class="o">=</span><span class="mf">0.0f</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">h</span><span class="o">&lt;</span><span class="n">hmax</span><span class="p">;</span><span class="n">h</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">phi</span><span class="o">+=</span><span class="mf">3.14159265359f</span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">hann</span><span class="o">=</span><span class="mf">0.5f</span><span class="o">+</span><span class="mf">0.5f</span><span class="o">*</span><span class="n">fast_cos</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0f</span><span class="o">/</span><span class="n">hmax</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">gaussienne</span><span class="o">=</span><span class="mf">0.85f</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">I</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">jupe</span><span class="o">=</span><span class="mf">0.15f</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">harmonique</span><span class="o">=</span><span class="n">cosf</span><span class="p">(</span><span class="n">phi</span><span class="p">);</span>
    <span class="n">a</span><span class="o">+=</span><span class="n">hann</span><span class="o">*</span><span class="p">(</span><span class="n">gaussienne</span><span class="o">+</span><span class="n">jupe</span><span class="p">)</span><span class="o">*</span><span class="n">harmonique</span><span class="p">;</span>
   <span class="p">}</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//Initialisation of the table TF with the fonction fonc_formant.</span>
<span class="kt">void</span> <span class="nf">init_formant</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span> <span class="kt">float</span> <span class="n">coef</span><span class="o">=</span><span class="mf">2.0f</span><span class="o">/</span><span class="p">(</span><span class="n">L_TABLE</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">I</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">I</span><span class="o">&lt;</span><span class="n">I_MAX</span><span class="p">;</span><span class="n">I</span><span class="o">++</span><span class="p">)</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">P</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">P</span><span class="o">&lt;</span><span class="n">L_TABLE</span><span class="p">;</span><span class="n">P</span><span class="o">++</span><span class="p">)</span>
      <span class="n">TF</span><span class="p">[</span><span class="n">P</span><span class="o">+</span><span class="n">I</span><span class="o">*</span><span class="n">L_TABLE</span><span class="p">]</span><span class="o">=</span><span class="n">fonc_formant</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">P</span><span class="o">*</span><span class="n">coef</span><span class="p">,</span><span class="kt">float</span><span class="p">(</span><span class="n">I</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">//This function emulates the function fonc_formant</span>
<span class="c1">// thanks to the table TF. A bilinear interpolation is</span>
<span class="c1">// performed</span>
<span class="kt">float</span> <span class="nf">formant</span><span class="p">(</span><span class="kt">float</span> <span class="n">p</span><span class="p">,</span><span class="kt">float</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="n">i</span><span class="o">&gt;</span><span class="n">I_MAX</span><span class="o">-</span><span class="mi">2</span><span class="o">?</span><span class="n">I_MAX</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span><span class="n">i</span><span class="p">;</span>    <span class="c1">// width limitation</span>
    <span class="kt">float</span> <span class="n">P</span><span class="o">=</span><span class="p">(</span><span class="n">L_TABLE</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5f</span><span class="p">;</span> <span class="c1">// phase normalisation</span>
    <span class="kt">int</span> <span class="n">P0</span><span class="o">=</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">P</span><span class="p">;</span>  <span class="kt">float</span> <span class="n">fP</span><span class="o">=</span><span class="n">P</span><span class="o">-</span><span class="n">P0</span><span class="p">;</span>  <span class="c1">// Integer and fractional</span>
    <span class="kt">int</span> <span class="n">I0</span><span class="o">=</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>  <span class="kt">float</span> <span class="n">fI</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="n">I0</span><span class="p">;</span>  <span class="c1">// parts of the phase (p) and width (i).</span>
    <span class="kt">int</span> <span class="n">i00</span><span class="o">=</span><span class="n">P0</span><span class="o">+</span><span class="n">L_TABLE</span><span class="o">*</span><span class="n">I0</span><span class="p">;</span>  <span class="kt">int</span> <span class="n">i10</span><span class="o">=</span><span class="n">i00</span><span class="o">+</span><span class="n">L_TABLE</span><span class="p">;</span>
    <span class="c1">//bilinear interpolation.</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">fI</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">TF</span><span class="p">[</span><span class="n">i00</span><span class="p">]</span> <span class="o">+</span> <span class="n">fP</span><span class="o">*</span><span class="p">(</span><span class="n">TF</span><span class="p">[</span><span class="n">i00</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">TF</span><span class="p">[</span><span class="n">i00</span><span class="p">]))</span>
        <span class="o">+</span>    <span class="n">fI</span><span class="o">*</span><span class="p">(</span><span class="n">TF</span><span class="p">[</span><span class="n">i10</span><span class="p">]</span> <span class="o">+</span> <span class="n">fP</span><span class="o">*</span><span class="p">(</span><span class="n">TF</span><span class="p">[</span><span class="n">i10</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">TF</span><span class="p">[</span><span class="n">i10</span><span class="p">]));</span>
<span class="p">}</span>

<span class="c1">// Double carrier.</span>
<span class="c1">// h : position (float harmonic number)</span>
<span class="c1">// p : phase</span>
<span class="kt">float</span> <span class="nf">porteuse</span><span class="p">(</span><span class="k">const</span> <span class="kt">float</span> <span class="n">h</span><span class="p">,</span><span class="k">const</span> <span class="kt">float</span> <span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span> <span class="n">h0</span><span class="o">=</span><span class="n">floor</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>  <span class="c1">//integer and</span>
  <span class="kt">float</span> <span class="n">hf</span><span class="o">=</span><span class="n">h</span><span class="o">-</span><span class="n">h0</span><span class="p">;</span>      <span class="c1">//decimal part of harmonic number.</span>
  <span class="c1">// modulos pour ramener p*h0 et p*(h0+1) dans [-1,1]</span>
  <span class="kt">float</span> <span class="n">phi0</span><span class="o">=</span><span class="n">fmodf</span><span class="p">(</span><span class="n">p</span><span class="o">*</span> <span class="n">h0</span>   <span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1000</span><span class="p">,</span><span class="mf">2.0f</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">phi1</span><span class="o">=</span><span class="n">fmodf</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">h0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">1000</span><span class="p">,</span><span class="mf">2.0f</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">;</span>
  <span class="c1">// two carriers.</span>
  <span class="kt">float</span> <span class="n">Porteuse0</span><span class="o">=</span><span class="n">fast_cos</span><span class="p">(</span><span class="n">phi0</span><span class="p">);</span>  <span class="kt">float</span> <span class="n">Porteuse1</span><span class="o">=</span><span class="n">fast_cos</span><span class="p">(</span><span class="n">phi1</span><span class="p">);</span>
  <span class="c1">// crossfade between the two carriers.</span>
  <span class="k">return</span> <span class="n">Porteuse0</span><span class="o">+</span><span class="n">hf</span><span class="o">*</span><span class="p">(</span><span class="n">Porteuse1</span><span class="o">-</span><span class="n">Porteuse0</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">//Formant table for various french vowels (you can add your own)</span>
  <span class="kt">float</span> <span class="n">F1</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span>  <span class="mi">730</span><span class="p">,</span>  <span class="mi">200</span><span class="p">,</span>  <span class="mi">400</span><span class="p">,</span>  <span class="mi">250</span><span class="p">,</span>  <span class="mi">190</span><span class="p">,</span>  <span class="mi">350</span><span class="p">,</span>  <span class="mi">550</span><span class="p">,</span>  <span class="mi">550</span><span class="p">,</span>  <span class="mi">450</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">A1</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">F2</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mi">1090</span><span class="p">,</span> <span class="mi">2100</span><span class="p">,</span>  <span class="mi">900</span><span class="p">,</span> <span class="mi">1700</span><span class="p">,</span>  <span class="mi">800</span><span class="p">,</span> <span class="mi">1900</span><span class="p">,</span> <span class="mi">1600</span><span class="p">,</span>  <span class="mi">850</span><span class="p">,</span> <span class="mi">1100</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">A2</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">,</span><span class="mf">0.35f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">0.5f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">F3</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mi">2440</span><span class="p">,</span> <span class="mi">3100</span><span class="p">,</span> <span class="mi">2300</span><span class="p">,</span> <span class="mi">2100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2500</span><span class="p">,</span> <span class="mi">2250</span><span class="p">,</span> <span class="mi">1900</span><span class="p">,</span> <span class="mi">1500</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">A3</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mf">0.3f</span><span class="p">,</span><span class="mf">0.15f</span><span class="p">,</span> <span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.4f</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">0.7f</span><span class="p">,</span> <span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.2f</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">F4</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mi">3400</span><span class="p">,</span> <span class="mi">4700</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">3300</span><span class="p">,</span> <span class="mi">3400</span><span class="p">,</span> <span class="mi">3700</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">};</span>
  <span class="kt">float</span> <span class="n">A4</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span> <span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">,</span> <span class="mf">0.2f</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">};</span>

  <span class="kt">float</span> <span class="n">f0</span><span class="p">,</span><span class="n">dp0</span><span class="p">,</span><span class="n">p0</span><span class="o">=</span><span class="mf">0.0f</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">F</span><span class="o">=</span><span class="mi">7</span><span class="p">;</span> <span class="c1">//number of the current formant preset</span>
  <span class="kt">float</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">;</span>
  <span class="n">f1</span><span class="o">=</span><span class="n">f2</span><span class="o">=</span><span class="n">f3</span><span class="o">=</span><span class="n">f4</span><span class="o">=</span><span class="mf">100.0f</span><span class="p">;</span><span class="n">a1</span><span class="o">=</span><span class="n">a2</span><span class="o">=</span><span class="n">a3</span><span class="o">=</span><span class="n">a4</span><span class="o">=</span><span class="mf">0.0f</span><span class="p">;</span>

  <span class="n">init_formant</span><span class="p">();</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s">&quot;sortie.pcm&quot;</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">ns</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">ns</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">*</span><span class="mi">44100</span><span class="p">;</span><span class="n">ns</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="o">==</span><span class="p">(</span><span class="n">ns</span><span class="o">%</span><span class="mi">11025</span><span class="p">)){</span><span class="n">F</span><span class="o">++</span><span class="p">;</span><span class="n">F</span><span class="o">%=</span><span class="mi">8</span><span class="p">;}</span> <span class="c1">//formant change</span>
    <span class="n">f0</span><span class="o">=</span><span class="mi">12</span><span class="o">*</span><span class="n">powf</span><span class="p">(</span><span class="mf">2.0f</span><span class="p">,</span><span class="mi">4</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">ns</span><span class="o">/</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mf">44100.0f</span><span class="p">));</span> <span class="c1">//sweep</span>
    <span class="n">f0</span><span class="o">*=</span><span class="p">(</span><span class="mf">1.0f</span><span class="o">+</span><span class="mf">0.01f</span><span class="o">*</span><span class="n">sinf</span><span class="p">(</span><span class="n">ns</span><span class="o">*</span><span class="mf">0.0015f</span><span class="p">));</span>        <span class="c1">//vibrato</span>
    <span class="n">dp0</span><span class="o">=</span><span class="n">f0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">22050.0f</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">un_f0</span><span class="o">=</span><span class="mf">1.0f</span><span class="o">/</span><span class="n">f0</span><span class="p">;</span>
    <span class="n">p0</span><span class="o">+=</span><span class="n">dp0</span><span class="p">;</span>  <span class="c1">//phase increment</span>
    <span class="n">p0</span><span class="o">-=</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">{</span> <span class="c1">//smoothing of the commands.</span>
      <span class="kt">float</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.001f</span><span class="p">;</span>
      <span class="n">f1</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">F1</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">f1</span><span class="p">);</span><span class="n">f2</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">F2</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">f2</span><span class="p">);</span><span class="n">f3</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">F3</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">f3</span><span class="p">);</span><span class="n">f4</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">F4</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">f4</span><span class="p">);</span>
      <span class="n">a1</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">A1</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">a1</span><span class="p">);</span><span class="n">a2</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">A2</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">a2</span><span class="p">);</span><span class="n">a3</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">A3</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">a3</span><span class="p">);</span><span class="n">a4</span><span class="o">+=</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">A4</span><span class="p">[</span><span class="n">F</span><span class="p">]</span><span class="o">-</span><span class="n">a4</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//The f0/fn coefficients stand for a -3dB/oct spectral enveloppe</span>
    <span class="kt">float</span> <span class="n">out</span><span class="o">=</span>
           <span class="n">a1</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">f1</span><span class="p">)</span><span class="o">*</span><span class="n">formant</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">un_f0</span><span class="p">)</span><span class="o">*</span><span class="n">porteuse</span><span class="p">(</span><span class="n">f1</span><span class="o">*</span><span class="n">un_f0</span><span class="p">,</span><span class="n">p0</span><span class="p">)</span>
     <span class="o">+</span><span class="mf">0.7f</span><span class="o">*</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">f2</span><span class="p">)</span><span class="o">*</span><span class="n">formant</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="mi">120</span><span class="o">*</span><span class="n">un_f0</span><span class="p">)</span><span class="o">*</span><span class="n">porteuse</span><span class="p">(</span><span class="n">f2</span><span class="o">*</span><span class="n">un_f0</span><span class="p">,</span><span class="n">p0</span><span class="p">)</span>
     <span class="o">+</span>     <span class="n">a3</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">f3</span><span class="p">)</span><span class="o">*</span><span class="n">formant</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="mi">150</span><span class="o">*</span><span class="n">un_f0</span><span class="p">)</span><span class="o">*</span><span class="n">porteuse</span><span class="p">(</span><span class="n">f3</span><span class="o">*</span><span class="n">un_f0</span><span class="p">,</span><span class="n">p0</span><span class="p">)</span>
     <span class="o">+</span>     <span class="n">a4</span><span class="o">*</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">f4</span><span class="p">)</span><span class="o">*</span><span class="n">formant</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span><span class="mi">300</span><span class="o">*</span><span class="n">un_f0</span><span class="p">)</span><span class="o">*</span><span class="n">porteuse</span><span class="p">(</span><span class="n">f4</span><span class="o">*</span><span class="n">un_f0</span><span class="p">,</span><span class="n">p0</span><span class="p">);</span>

    <span class="kt">short</span> <span class="n">s</span><span class="o">=</span><span class="kt">short</span><span class="p">(</span><span class="mf">15000.0f</span><span class="o">*</span><span class="n">out</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">);</span><span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">);</span> <span class="c1">//fichier raw pcm stereo</span>
  <span class="p">}</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-04-24 12:04:12</p></li>
<li><p><strong>By</strong>: Baltazar</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Quite interesting and efficient for an algo that does not use any filter ;-)
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-08-14 11:30:14</p></li>
<li><p><strong>By</strong>: phoenix-69</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Very funny sound !
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-08-19 20:51:30</p></li>
<li><p><strong>By</strong>: Wait.</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>What header files are you including?
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="1-alias-free-waveform-generation-with-analog-filtering.html" class="btn btn-neutral float-right" title="Alias-free waveform generation with analog filtering" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="16-allmost-ready-to-use-oscillators.html" class="btn btn-neutral float-left" title="(Allmost) Ready-to-use oscillators" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>