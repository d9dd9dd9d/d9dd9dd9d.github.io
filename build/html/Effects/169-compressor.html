

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Compressor &mdash; Notebook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Decimator" href="124-decimator.html" />
    <link rel="prev" title="Class for waveguide/delay effects" href="98-class-for-waveguide-delay-effects.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Notebook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filters/index.html">Filters</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Effects</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="89-2-wave-shaping-things.html">2 Wave shaping things</a></li>
<li class="toctree-l2"><a class="reference internal" href="70-alien-wah.html">Alien Wah</a></li>
<li class="toctree-l2"><a class="reference internal" href="221-band-limited-pwm-generator.html">Band Limited PWM Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="96-bit-quantization-reduction-effect.html">Bit quantization/reduction effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="98-class-for-waveguide-delay-effects.html">Class for waveguide/delay effects</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compressor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="124-decimator.html">Decimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="44-delay-time-calculation-for-reverberation.html">Delay time calculation for reverberation</a></li>
<li class="toctree-l2"><a class="reference internal" href="207-dynamic-convolution.html">Dynamic convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="102-ece320-project-reverberation-w-parameter-control-from-pc.html">ECE320 project: Reverberation w/ parameter control from PC</a></li>
<li class="toctree-l2"><a class="reference internal" href="74-early-echo-s-with-image-mirror-technique.html">Early echo’s with image-mirror technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="203-fold-back-distortion.html">Fold back distortion</a></li>
<li class="toctree-l2"><a class="reference internal" href="47-guitar-feedback.html">Guitar feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="139-lo-fi-crusher.html">Lo-Fi Crusher</a></li>
<li class="toctree-l2"><a class="reference internal" href="274-lookahead-limiter.html">Lookahead Limiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="154-most-simple-and-smooth-feedback-delay.html">Most simple and smooth feedback delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="153-most-simple-static-delay.html">Most simple static delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="101-parallel-combs-delay-calculation.html">Parallel combs delay calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="78-phaser-code.html">Phaser code</a></li>
<li class="toctree-l2"><a class="reference internal" href="230-polynominal-waveshaper.html">Polynominal Waveshaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="150-reverberation-algorithms-in-matlab.html">Reverberation Algorithms in Matlab</a></li>
<li class="toctree-l2"><a class="reference internal" href="45-reverberation-techniques.html">Reverberation techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="204-simple-compressor-class-c.html">Simple Compressor class (C++)</a></li>
<li class="toctree-l2"><a class="reference internal" href="42-soft-saturation.html">Soft saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="173-stereo-enhancer.html">Stereo Enhancer</a></li>
<li class="toctree-l2"><a class="reference internal" href="255-stereo-field-rotation-via-transformation-matrix.html">Stereo Field Rotation Via Transformation Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="256-stereo-width-control-obtained-via-transfromation-matrix.html">Stereo Width Control (Obtained Via Transfromation Matrix)</a></li>
<li class="toctree-l2"><a class="reference internal" href="126-time-compression-expansion-using-standard-phase-vocoder.html">Time compression-expansion using standard phase vocoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="177-transistor-differential-amplifier-simulation.html">Transistor differential amplifier simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="277-univox-univibe-emulator.html">UniVox Univibe Emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="104-variable-hardness-clipping-function.html">Variable-hardness clipping function</a></li>
<li class="toctree-l2"><a class="reference internal" href="41-waveshaper.html">WaveShaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="43-waveshaper.html">Waveshaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="46-waveshaper.html">Waveshaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="114-waveshaper-simple-description.html">Waveshaper (simple description)</a></li>
<li class="toctree-l2"><a class="reference internal" href="86-waveshaper-gloubi-boulga.html">Waveshaper :: Gloubi-boulga</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Effects</a> &raquo;</li>
        
      <li>Compressor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compressor">
<h1>Compressor<a class="headerlink" href="#compressor" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> <a class="reference external" href="mailto:ur&#46;liam&#37;&#52;&#48;cnihsalf">ur<span>&#46;</span>liam<span>&#64;</span>cnihsalf</a></p></li>
<li><p><strong>Type:</strong> Hardknee compressor with RMS look-ahead envelope calculation and adjustable attack/decay</p></li>
<li><p><strong>Created:</strong> 2004-05-26 16:02:59</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>RMS is a true way to estimate _musical_ signal energy,
our ears behaves in a same way.

to making all it work,
try this values (as is, routine accepts percents and milliseconds) for first time:

threshold = 50%
slope = 50%
RMS window width = 1 ms
lookahead = 3 ms
attack time = 0.1 ms
release time = 300 ms

This code can be significantly improved in speed by
changing RMS calculation loop to &#39;running summ&#39;
(keeping the summ in &#39;window&#39; -
adding next newest sample and subtracting oldest on each step)
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">compress</span>
    <span class="p">(</span>
        <span class="kt">float</span><span class="o">*</span>  <span class="n">wav_in</span><span class="p">,</span>     <span class="c1">// signal</span>
        <span class="kt">int</span>     <span class="n">n</span><span class="p">,</span>          <span class="c1">// N samples</span>
        <span class="kt">double</span>  <span class="n">threshold</span><span class="p">,</span>  <span class="o">//</span> <span class="n">threshold</span> <span class="p">(</span><span class="n">percents</span><span class="p">)</span>
        <span class="kt">double</span>  <span class="n">slope</span><span class="p">,</span>      <span class="c1">// slope angle (percents)</span>
        <span class="kt">int</span>     <span class="n">sr</span><span class="p">,</span>         <span class="c1">// sample rate (smp/sec)</span>
        <span class="kt">double</span>  <span class="n">tla</span><span class="p">,</span>        <span class="c1">// lookahead  (ms)</span>
        <span class="kt">double</span>  <span class="n">twnd</span><span class="p">,</span>       <span class="c1">// window time (ms)</span>
        <span class="kt">double</span>  <span class="n">tatt</span><span class="p">,</span>       <span class="c1">// attack time  (ms)</span>
        <span class="kt">double</span>  <span class="n">trel</span>        <span class="c1">// release time (ms)</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="k">typedef</span> <span class="kt">float</span>   <span class="n">stereodata</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">stereodata</span><span class="o">*</span>     <span class="n">wav</span> <span class="o">=</span> <span class="p">(</span><span class="n">stereodata</span><span class="o">*</span><span class="p">)</span> <span class="n">wav_in</span><span class="p">;</span> <span class="c1">// our stereo signal</span>
    <span class="n">threshold</span> <span class="o">*=</span> <span class="mf">0.01</span><span class="p">;</span>          <span class="c1">// threshold to unity (0...1)</span>
    <span class="n">slope</span> <span class="o">*=</span> <span class="mf">0.01</span><span class="p">;</span>              <span class="c1">// slope to unity</span>
    <span class="n">tla</span> <span class="o">*=</span> <span class="mf">1e-3</span><span class="p">;</span>                <span class="c1">// lookahead time to seconds</span>
    <span class="n">twnd</span> <span class="o">*=</span> <span class="mf">1e-3</span><span class="p">;</span>               <span class="c1">// window time to seconds</span>
    <span class="n">tatt</span> <span class="o">*=</span> <span class="mf">1e-3</span><span class="p">;</span>               <span class="c1">// attack time to seconds</span>
    <span class="n">trel</span> <span class="o">*=</span> <span class="mf">1e-3</span><span class="p">;</span>               <span class="c1">// release time to seconds</span>

    <span class="c1">// attack and release &quot;per sample decay&quot;</span>
    <span class="kt">double</span>  <span class="n">att</span> <span class="o">=</span> <span class="p">(</span><span class="n">tatt</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">:</span> <span class="n">exp</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">tatt</span><span class="p">));</span>
    <span class="kt">double</span>  <span class="n">rel</span> <span class="o">=</span> <span class="p">(</span><span class="n">trel</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">:</span> <span class="n">exp</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">trel</span><span class="p">));</span>

    <span class="c1">// envelope</span>
    <span class="kt">double</span>  <span class="n">env</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="c1">// sample offset to lookahead wnd start</span>
    <span class="kt">int</span>     <span class="n">lhsmp</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">tla</span><span class="p">);</span>

    <span class="c1">// samples count in lookahead window</span>
    <span class="kt">int</span>     <span class="n">nrms</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">sr</span> <span class="o">*</span> <span class="n">twnd</span><span class="p">);</span>

    <span class="c1">// for each sample...</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// now compute RMS</span>
        <span class="kt">double</span>  <span class="n">summ</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="c1">// for each sample in window</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nrms</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span>     <span class="n">lki</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">lhsmp</span><span class="p">;</span>
            <span class="kt">double</span>  <span class="n">smp</span><span class="p">;</span>

            <span class="c1">// if we in bounds of signal?</span>
            <span class="c1">// if so, convert to mono</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lki</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span>
                <span class="n">smp</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">wav</span><span class="p">[</span><span class="n">lki</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">wav</span><span class="p">[</span><span class="n">lki</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
            <span class="k">else</span>
                <span class="n">smp</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>      <span class="c1">// if we out of bounds we just get zero in smp</span>

            <span class="n">summ</span> <span class="o">+=</span> <span class="n">smp</span> <span class="o">*</span> <span class="n">smp</span><span class="p">;</span>  <span class="c1">// square em..</span>
        <span class="p">}</span>

        <span class="kt">double</span>  <span class="n">rms</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span><span class="n">summ</span> <span class="o">/</span> <span class="n">nrms</span><span class="p">);</span>   <span class="c1">// root-mean-square</span>

        <span class="c1">// dynamic selection: attack or release?</span>
        <span class="kt">double</span>  <span class="n">theta</span> <span class="o">=</span> <span class="n">rms</span> <span class="o">&gt;</span> <span class="n">env</span> <span class="o">?</span> <span class="nl">att</span> <span class="p">:</span> <span class="n">rel</span><span class="p">;</span>

        <span class="c1">// smoothing with capacitor, envelope extraction...</span>
        <span class="c1">// here be aware of pIV denormal numbers glitch</span>
        <span class="n">env</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">rms</span> <span class="o">+</span> <span class="n">theta</span> <span class="o">*</span> <span class="n">env</span><span class="p">;</span>

        <span class="c1">// the very easy hard knee 1:N compressor</span>
        <span class="kt">double</span>  <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">env</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="p">(</span><span class="n">env</span> <span class="o">-</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">*</span> <span class="n">slope</span><span class="p">;</span>

        <span class="c1">// result - two hard kneed compressed channels...</span>
        <span class="kt">float</span>  <span class="n">leftchannel</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">gain</span><span class="p">;</span>
        <span class="kt">float</span>  <span class="n">rightchannel</span> <span class="o">=</span> <span class="n">wav</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">gain</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2004-06-10 21:31:18</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;regnimmu&#37;&#52;&#48;psd-cisum">moc<span>&#46;</span>regnimmu<span>&#64;</span>psd-cisum</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>My comments:

A rectangular window is not physical. It would make more physical sense, and be a lot cheaper, to
use a 1-pole low pass filter to do the RMS averaging. A 1-pole filter means you can lose the bounds
checks in the RMS calculation.

It does not make sense to convert to mono before squaring, you should square each channel
separately and then add them together to get the total signal power.

You might also consider whether you even need any filtering other than the attack/release filter.
You could modify the attack/release rates appropriately, place the sqrt after the attack/release,
and lose the rms averager entirely.

I don&#39;t think your compressor actually approaches a linear slope in the decibel domain. You need
a gain law more like

double gain = exp(max(0.0,log(env)-log(thresh))*slope);

Sincerely,
     Frederick Umminger
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2004-07-30 05:31:36</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;noteex">moc<span>&#46;</span>liamg<span>&#64;</span>noteex</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>To sum up (and maybe augment) the RMS calculation method, this question and answer may be of use...

**********

music-dsp@shoko.calarts.edu writes:
I am looking at gain processing algorithms. I haven&#39;t found much in the way of reference material on
this, any pointers? In the level detection code, if one is doing peak detection, how many samples
does one generally average over (if at all)? What kind of window size for RMS level detection?
Is the RMS level detection generally the same algo. as peak, but with a bigger window?

The peak detector can be easily implemented as a one-pole low pass, you just have modify it,
so that it tracks the peaks and gently falls down afterwards. RMS detection is done squaring
the input signal, averaging with a lowpass and taking the root afterwards.

Hope this helps.

Kind regards

Steffan Diedrichsen

DSP developer

emagic GmbH

**********

I found the thread by searching old [music-dsp] forum posts. Hope it helps.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2006-11-07 01:52:17</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:gro&#46;esabnaeco&#37;&#52;&#48;euarg">gro<span>&#46;</span>esabnaeco<span>&#64;</span>euarg</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>How would you use a 1-pole lowpass filter to do RMS averaging? How do you pick a coefficient to use?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2006-11-09 01:19:41</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:uh&#46;etle&#46;fni&#37;&#52;&#48;yfoocs">uh<span>&#46;</span>etle<span>&#46;</span>fni<span>&#64;</span>yfoocs</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Use x = exp(-1/d), where d is the time constant in samples. A 1 pole IIR filter has an infinite
impulse response, so instead of window width, this coeff determines the time when the impulse
response reaches 36.8% of the original value.

Coeffs:
a0 = 1.0-x;
b1 = -x;

Loop:
out = a0*in - b1*tmp;
tmp = out;

-- peter schoffhauzer
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-20 08:30:28</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;361&#37;&#52;&#48;oatuxt">moc<span>&#46;</span>361<span>&#64;</span>oatuxt</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I am looking at gain processing algorithms£º
There are too such sentences :
double att = (tatt == 0.0) ? (0.0) : exp (-1.0 / (sr * tatt));
double rel = (trel == 0.0) ? (0.0) : exp (-1.0 / (sr * trel));

can you tell me something about the exp (-1.0 / (sr * tatt))?

New day ~~
thanks
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2010-04-28 15:12:47</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;enin&#46;kap">moc<span>&#46;</span>liamg<span>&#64;</span>enin<span>&#46;</span>kap</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This is a useful reference, however the RMS calculations are pretty dodgy. Firstly there is a
bug where is calculates the number of samples to use:

int sr, // sample rate (smp/sec)
...
double twnd, // window time (ms)
...
// samples count in lookahead window
int nrms = (int) (sr * twnd);

The units are mixed when calculating the number of samples in the RMS window. The window time needs
to be converted to seconds before multiplying by the sample rate.

As others have mentioned the RMS calculation is also really expensive, and in my tests I found it
was pretty innacurate unless you use a LOT of samples (you basically need a (sample rate)/2 window
of samples in your RMS calculation to accurately measure the power of all frequencies).

I ended up using the 1 pole low pass filter approach suggested here, and it is a good cheap
approximation of power. I did, however, end up mulitplying it by root(2) (the RMS of a sine wave,
which seemed like a reasonable normalisation factor) in order to get it between 0 and 1, which is
a more useful range.

Another slightly more accurate way to caculate the RMS without iterating over and entire window
for each sample is to keep a running total of the squared sums of samples.

for( i = 0; i &lt; NumSamples; ++i )
{
  NewSample = Sample[i];
  OldSample = Sample[i - RMSWindowSize];

  SquaredSum = SquaredSum + NewSample * NewSample;
  SquaredSum = SquaredSum - OldSample * OldSample;

  RMS = sqrt( SquaredSum / RMSWindowSize );

  // etc...
}

Calculating the power in the signal is definately the awkward part of this DSP!
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="124-decimator.html" class="btn btn-neutral float-right" title="Decimator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="98-class-for-waveguide-delay-effects.html" class="btn btn-neutral float-left" title="Class for waveguide/delay effects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>