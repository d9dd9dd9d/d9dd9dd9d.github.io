

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stereo Field Rotation Via Transformation Matrix &mdash; Notebook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stereo Width Control (Obtained Via Transfromation Matrix)" href="256-stereo-width-control-obtained-via-transfromation-matrix.html" />
    <link rel="prev" title="Stereo Enhancer" href="173-stereo-enhancer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Notebook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Filters/index.html">Filters</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Effects</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="89-2-wave-shaping-things.html">2 Wave shaping things</a></li>
<li class="toctree-l2"><a class="reference internal" href="70-alien-wah.html">Alien Wah</a></li>
<li class="toctree-l2"><a class="reference internal" href="221-band-limited-pwm-generator.html">Band Limited PWM Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="96-bit-quantization-reduction-effect.html">Bit quantization/reduction effect</a></li>
<li class="toctree-l2"><a class="reference internal" href="98-class-for-waveguide-delay-effects.html">Class for waveguide/delay effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="169-compressor.html">Compressor</a></li>
<li class="toctree-l2"><a class="reference internal" href="124-decimator.html">Decimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="44-delay-time-calculation-for-reverberation.html">Delay time calculation for reverberation</a></li>
<li class="toctree-l2"><a class="reference internal" href="207-dynamic-convolution.html">Dynamic convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="102-ece320-project-reverberation-w-parameter-control-from-pc.html">ECE320 project: Reverberation w/ parameter control from PC</a></li>
<li class="toctree-l2"><a class="reference internal" href="74-early-echo-s-with-image-mirror-technique.html">Early echo’s with image-mirror technique</a></li>
<li class="toctree-l2"><a class="reference internal" href="203-fold-back-distortion.html">Fold back distortion</a></li>
<li class="toctree-l2"><a class="reference internal" href="47-guitar-feedback.html">Guitar feedback</a></li>
<li class="toctree-l2"><a class="reference internal" href="139-lo-fi-crusher.html">Lo-Fi Crusher</a></li>
<li class="toctree-l2"><a class="reference internal" href="274-lookahead-limiter.html">Lookahead Limiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="154-most-simple-and-smooth-feedback-delay.html">Most simple and smooth feedback delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="153-most-simple-static-delay.html">Most simple static delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="101-parallel-combs-delay-calculation.html">Parallel combs delay calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="78-phaser-code.html">Phaser code</a></li>
<li class="toctree-l2"><a class="reference internal" href="230-polynominal-waveshaper.html">Polynominal Waveshaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="150-reverberation-algorithms-in-matlab.html">Reverberation Algorithms in Matlab</a></li>
<li class="toctree-l2"><a class="reference internal" href="45-reverberation-techniques.html">Reverberation techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="204-simple-compressor-class-c.html">Simple Compressor class (C++)</a></li>
<li class="toctree-l2"><a class="reference internal" href="42-soft-saturation.html">Soft saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="173-stereo-enhancer.html">Stereo Enhancer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stereo Field Rotation Via Transformation Matrix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="256-stereo-width-control-obtained-via-transfromation-matrix.html">Stereo Width Control (Obtained Via Transfromation Matrix)</a></li>
<li class="toctree-l2"><a class="reference internal" href="126-time-compression-expansion-using-standard-phase-vocoder.html">Time compression-expansion using standard phase vocoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="177-transistor-differential-amplifier-simulation.html">Transistor differential amplifier simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="277-univox-univibe-emulator.html">UniVox Univibe Emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="104-variable-hardness-clipping-function.html">Variable-hardness clipping function</a></li>
<li class="toctree-l2"><a class="reference internal" href="41-waveshaper.html">WaveShaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="43-waveshaper.html">Waveshaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="46-waveshaper.html">Waveshaper</a></li>
<li class="toctree-l2"><a class="reference internal" href="114-waveshaper-simple-description.html">Waveshaper (simple description)</a></li>
<li class="toctree-l2"><a class="reference internal" href="86-waveshaper-gloubi-boulga.html">Waveshaper :: Gloubi-boulga</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Effects</a> &raquo;</li>
        
      <li>Stereo Field Rotation Via Transformation Matrix</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stereo-field-rotation-via-transformation-matrix">
<h1>Stereo Field Rotation Via Transformation Matrix<a class="headerlink" href="#stereo-field-rotation-via-transformation-matrix" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> Michael Gruhn</p></li>
<li><p><strong>Type:</strong> Stereo Field Rotation</p></li>
<li><p><strong>Created:</strong> 2008-03-17 09:40:10</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This work is hereby placed in the public domain for all purposes, including use in
commercial applications.

&#39;angle&#39; is the angle by which you want to rotate your stereo field.
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Calculate transformation matrix&#39;s coefficients</span>
<span class="n">cos_coef</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
<span class="n">sin_coef</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>

<span class="c1">// Do this per sample</span>
<span class="n">out_left</span>  <span class="o">=</span> <span class="n">in_left</span> <span class="o">*</span> <span class="n">cos_coef</span> <span class="o">-</span> <span class="n">in_right</span> <span class="o">*</span> <span class="n">sin_coef</span><span class="p">;</span>
<span class="n">out_right</span> <span class="o">=</span> <span class="n">in_left</span> <span class="o">*</span> <span class="n">sin_coef</span> <span class="o">+</span> <span class="n">in_right</span> <span class="o">*</span> <span class="n">cos_coef</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-10-07 19:56:47</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamtoh&#37;&#52;&#48;iniluigj">moc<span>&#46;</span>liamtoh<span>&#64;</span>iniluigj</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This looks like the rotation formula for a point in space. Can you explain how does it work
for a sound signal? Let&#39;s say that angle is 90 degrees, then you formula gives
out_left = -in_right
out_right = in_left
How would this be a 90 deg rotation of the sound?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-10-15 12:16:02</p></li>
<li><p><strong>By</strong>: Foo</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>It IS the exact formula as rotation for a point in a 2D space (around its origin). Now this is
applied to the stereo field. Imagine it as a left-right plot, so the values of the left and right
channel get plotted (just like a goniometer: http://en.wikipedia.org/wiki/Goniometer_(audio)).
So now you can see the stereo image (mono = straight line, stereo = circle, etc...). Now when you
rotate THIS plot and then use the values of the rotated plot for the new left and right sample
values, you rotated the stereo image.
So just get a goniometer and look at how the signal changes when you run it through the algorithm,
it will be pretty obvious.

Hope this helps.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-16 02:13:27</p></li>
<li><p><strong>By</strong>: Bar</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Sorry this makes no sense at all. The rotation formula is predicated on the assumption that
(x,y) are coordinates of two orthogonal dimensions. Now you can choose to visualize stereo
signals anyway you like, including being on a Cartesian plan, or as polar coordinates, what have
you... But this visualization has no relationship to the physical location of the sound. The left
and right channels are NOT orthogonal dimensions physically. What the formula does is just some
weird panning. As the previous comment pointed out, just plug in some easy angles like 90, 180 ...
and see if you can make any valid interpretations out of them. You can&#39;t.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-18 21:22:49</p></li>
<li><p><strong>By</strong>: Foo</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>So you want mathematical prove? Even though I consider this childish, because it&#39;d take you &lt;5
minutes to put this in Matlab or any other DSP prototyping bench and hear the rotation effect for
yourself. Anyway ...

For 180° the output should be totally inverted. So:
cos(180) = -1
sin(180) =  0
out_left = -in_left
out_right = -in_right

at 90° this means for a mono signal that the left channel will be a phase inverse of the right
channel, so ... go directly to result, do not calculate:
out_left = -in_right
out_right = in_left

at 45° is just like hard panning to the right (with a 3dB volume attenuation), so for a mono
signal the expected results would be one channel silence and the other would have the signal,
so we calculate:
cos(45) = sqrt(2)/2
sin(45) = sqrt(2)/2
for mono signal we assume: mono = in_left = in_right ... so it follows:
out_left = mono * sqrt(2)/2 - mono * sqrt(2)/2 = 0
out_right = mono * sqrt(2)/2 + mono * sqrt(2)/2 = mono * sqrt(2) == mono * 3dB

and one more, 360° means same output as input, calculate for yourself.

Valid enough?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-20 20:18:24</p></li>
<li><p><strong>By</strong>: Bar</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Then I&#39;m not sure what you mean by rotation. In my mind, I see two sound sources at arbitrary
locations and I&#39;m at the center of rotation. So the effect of a rotation would depend on the
angle subtended by the three points to begin with, which doesn&#39;t even show up in the formula.
Also please explains what does it mean by the two channels being orthogonal dimensions, which
is what the formula is based on. (I assume you understand the mathematical basis of how the
formula is derived.)

No, a phase inversion on both channels don&#39;t sound 180 deg rotated. It sounds exactly the same
as before.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-20 21:27:25</p></li>
<li><p><strong>By</strong>: Bar</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Let&#39;s try another experiment. You&#39;re in the midpoint of the line joining the two speakers and is
the center of rotation. Your signal happens to have all zeros for the left channel. The formula
simplifies to:
out_left = -in_right * sin
out_right = in_right * cos
As you rotate from 0 to 90, sin goes from 0 to 1, cos goes from 1 to 0. So the formula predicts
that the left channel goes from silence to a phase inverted right, and the right channel goes from
full sound to silence. Whereas physically the sound should move from my right to directly in front of
me. Please explain.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-20 21:36:54</p></li>
<li><p><strong>By</strong>: Bar</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Yet another childish thought. If one can treat signals as if they were space locations, then surely
translations will work just as well as rotations. So to move a sound source to another location,
one just add constants to the signals?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-11-23 18:10:37</p></li>
<li><p><strong>By</strong>: Foo</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>If the source would be dead center a 180° rotation would mean the source would be behind you,
but since in stereo there is no front or behind (just left and right), behind gets indicated by
phase reversal (I know it doesn&#39;t reflect the position, but you can&#39;t because there is only left
and right).
Also the rotation is clockwise, so a positive angles shift the source to the right, which means
for your example if you&#39;d rotate from 0° to -90° you&#39;d indeed get the signal one the left channel
and the right blank. For a mono signal (both channels identical that is) and a rotation range of
-45° to 45° is the same as panning (with a 0dB pan law).

But I&#39;ll admit I was totally wrong and this entry in the musicdsp is the most faultiest that there
ever was and isn&#39;t going to be useful at all, to no one.
Anyway if this is not stereo field rotation, how would YOU call it? I&#39;d happily forward the new
terminology to the siteadmin, so the entries&#39; description can be changed as soon as possible to
whatever you think it is.

I&#39;m just glad that I&#39;m not the only one that is using wrong terminology, e.g. the Waves S1-Imager&#39;s
&quot;Rotation&quot; does the same as the above posted code, as does Nick Whitehurst&#39;s c_superstereo and
others ...

So tell me what it is called and I&#39;ll see if I can get the name changed, so everyone can be happy.
Though I doubt I can get Waves nor any audio engineers to also adapt the new, correct terminology,
that you will proved, for this kind of effect.

BTW if you want to discuss this further please mail to: 1337foo42bar69@trashmail.net because there
is no need to waste more comment space about this (I now think or at least hope that it only is a ...)
terminology discussion, because there is nothing wrong with the code itself I posted, or is there?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-07-17 11:02:36</p></li>
<li><p><strong>By</strong>: null</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Waves S1 Rotation, as you said, does exactly this. It is stereo field rotation, but in the same
way could be considered panning.

Thanks a lot for the useful code, it will be put to good use. :)
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2014-03-28 12:52:38</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;nabihci&#46;nasleinad">moc<span>&#46;</span>liamg<span>&#64;</span>nabihci<span>&#46;</span>nasleinad</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I just tried this out but as you rotate the field there are points where the field is flattened
to become simply a mono signal rotated. visualize the output on a x/y vectorscope and perform the
roation to see what I mean.

I made a correction.  The algorithm should be like this:

r = rotation_angle

out_left   = (in_left *  cos(r))  - (in_right * sin(r + pi));
out_right = (in_left * -sin(r)) - (in_right * cos(r + pi));
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2014-06-17 22:51:38</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;jdcisumff">moc<span>&#46;</span>liamg<span>&#64;</span>jdcisumff</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Why are you adding pi to the sin and cos at the end?

What will adding 3.14 to the rotation do besides move the rotation angle further 3.14? IE if rotation
angle is 90, you&#39;re just adding 3.14 to it  equaling 93.14. Why only to the right channel? Shouldn&#39;t
that cause problems?

Wouldn&#39;t that mean that the reason this wont sound flat is because the calculations are 3.14 off?
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="256-stereo-width-control-obtained-via-transfromation-matrix.html" class="btn btn-neutral float-right" title="Stereo Width Control (Obtained Via Transfromation Matrix)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="173-stereo-enhancer.html" class="btn btn-neutral float-left" title="Stereo Enhancer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>