

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MDCT and IMDCT based on FFTW3 &mdash; Notebook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Moog Filter" href="196-moog-filter.html" />
    <link rel="prev" title="Lowpass filter for parameter edge filtering" href="28-lowpass-filter-for-parameter-edge-filtering.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Notebook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Filters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="257-1-pole-lpf-for-smooth-parameter-changes.html">1 pole LPF for smooth parameter changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="185-1-rc-and-c-filter.html">1-RC and C filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="72-18db-oct-resonant-3-pole-lpf-with-tanh-dist.html">18dB/oct resonant 3 pole LPF with tanh() dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="85-1st-and-2nd-order-pink-noise-filters.html">1st and 2nd order pink noise filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="236-3-band-equaliser.html">3 Band Equaliser</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-303-type-filter-with-saturation.html">303 type filter with saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="266-4th-order-linkwitz-riley-filters.html">4th order Linkwitz-Riley filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-all-pass-filters-a-good-explanation.html">All-Pass Filters, a good explanation</a></li>
<li class="toctree-l2"><a class="reference internal" href="181-another-4-pole-lowpass.html">Another 4-pole lowpass…</a></li>
<li class="toctree-l2"><a class="reference internal" href="235-bass-booster.html">Bass Booster</a></li>
<li class="toctree-l2"><a class="reference internal" href="64-biquad-c-code.html">Biquad C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="276-biquad-butterworth-chebyshev-n-order-m-channel-optimized-filters.html">Biquad, Butterworth, Chebyshev N-order, M-channel  optimized filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="243-butterworth-optimized-c-class.html">Butterworth Optimized C++ Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="128-c-class-implementation-of-rbj-filters.html">C++ class implementation of RBJ Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="226-c-weighed-filter.html">C-Weighed Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="131-cascaded-resonant-lp-hp-filter.html">Cascaded resonant lp/hp filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="180-cool-sounding-lowpass-with-decibel-measured-resonance.html">Cool Sounding Lowpass With Decibel Measured Resonance</a></li>
<li class="toctree-l2"><a class="reference internal" href="135-dc-filter.html">DC filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="225-delphi-class-implementation-of-the-rbj-filters.html">Delphi Class implementation of the RBJ filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="122-digital-riaa-equalization-filter-coefficients.html">Digital RIAA equalization filter coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="275-direct-form-ii-biquad.html">Direct Form II biquad</a></li>
<li class="toctree-l2"><a class="reference internal" href="174-direct-form-ii.html">Direct form II</a></li>
<li class="toctree-l2"><a class="reference internal" href="214-fast-downsampling-with-antialiasing.html">Fast Downsampling With Antialiasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="110-formant-filter.html">Formant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="179-frequency-warped-fir-lattice.html">Frequency warped FIR lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="195-hilbert-filter-coefficient-calculation.html">Hilbert Filter Coefficient Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="231-hiqh-quality-2-decimators.html">Hiqh quality /2 decimators</a></li>
<li class="toctree-l2"><a class="reference internal" href="141-karlsen.html">Karlsen</a></li>
<li class="toctree-l2"><a class="reference internal" href="240-karlsen-fast-ladder.html">Karlsen Fast Ladder</a></li>
<li class="toctree-l2"><a class="reference internal" href="38-lp-and-hp-filter.html">LP and HP filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="229-lpf-24db-oct.html">LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="28-lowpass-filter-for-parameter-edge-filtering.html">Lowpass filter for parameter edge filtering</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MDCT and IMDCT based on FFTW3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="196-moog-filter.html">Moog Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="24-moog-vcf.html">Moog VCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="25-moog-vcf-variation-1.html">Moog VCF, variation 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="26-moog-vcf-variation-2.html">Moog VCF, variation 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="35-notch-filter.html">Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="116-one-pole-lp-and-hp.html">One pole LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="237-one-pole-filter-lp-and-hp.html">One pole filter, LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="117-one-pole-one-zero-lp-hp.html">One pole, one zero LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="118-one-zero-lp-hp.html">One zero, LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="263-one-liner-iir-filters-1st-order.html">One-Liner IIR Filters (1st order)</a></li>
<li class="toctree-l2"><a class="reference internal" href="265-output-limiter-using-envelope-follower-in-c.html">Output Limiter using Envelope Follower in C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="130-peak-notch-filter.html">Peak/Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="253-perfect-lp4-filter.html">Perfect LP4 filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="76-pink-noise-filter.html">Pink noise filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="251-plot-filter-analyze-filter-characteristics.html">Plot Filter (Analyze filter characteristics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="218-plotting-r-b-j-equalisers-in-excel.html">Plotting R B-J Equalisers in Excel</a></li>
<li class="toctree-l2"><a class="reference internal" href="39-polyphase-filters.html">Polyphase Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="223-polyphase-filters-delphi.html">Polyphase Filters (Delphi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="247-poor-man-s-fiwiz.html">Poor Man’s FIWIZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="34-prewarping.html">Prewarping</a></li>
<li class="toctree-l2"><a class="reference internal" href="197-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="198-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="209-remez-exchange-algorithm-parks-mcclellan.html">Remez Exchange Algorithm (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="208-remez-remez-parks-mcclellan.html">Remez Remez (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="27-resonant-iir-lowpass-12db-oct.html">Resonant IIR lowpass (12dB/oct)</a></li>
<li class="toctree-l2"><a class="reference internal" href="29-resonant-filter.html">Resonant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="33-resonant-low-pass-filter.html">Resonant low pass filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="176-reverb-filter-generator.html">Reverb Filter Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="267-simple-tilt-equalizer.html">Simple Tilt equalizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="259-simple-biquad-filter-from-apple-com.html">Simple biquad filter from apple.com</a></li>
<li class="toctree-l2"><a class="reference internal" href="258-spuc-s-open-source-filters.html">Spuc’s open source filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="142-state-variable-filter-chamberlin-version.html">State Variable Filter (Chamberlin version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="92-state-variable-filter-double-sampled-stable.html">State Variable Filter (Double Sampled, Stable)</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-state-variable.html">State variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="145-stilson-s-moog-filter-code.html">Stilson’s Moog filter code</a></li>
<li class="toctree-l2"><a class="reference internal" href="65-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="66-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="232-type-lpf-24db-oct.html">Type : LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="32-various-biquad-filters.html">Various Biquad filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="194-windowed-sinc-fir-generator.html">Windowed Sinc FIR Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="37-zoelzer-biquad-filters.html">Zoelzer biquad filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Filters</a> &raquo;</li>
        
      <li>MDCT and IMDCT based on FFTW3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mdct-and-imdct-based-on-fftw3">
<h1>MDCT and IMDCT based on FFTW3<a class="headerlink" href="#mdct-and-imdct-based-on-fftw3" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;gnahz&#46;auhuhs">moc<span>&#46;</span>liamg<span>&#64;</span>gnahz<span>&#46;</span>auhuhs</a></p></li>
<li><p><strong>Type:</strong> analysis and synthesis filterbank</p></li>
<li><p><strong>Created:</strong> 2009-07-31 06:37:37</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MDCT/IMDCT is the most widely used filterbank in digital audio coding, e.g. MP3, AAC, WMA,
OGG Vorbis, ATRAC.

suppose input x and N=size(x,1)/2. the MDCT transform matrix is
    C=cos(pi/N*([0:2*N-1]&#39;+.5+.5*N)*([0:N-1]+.5));
then MDCT spectrum for input x is
    y=C&#39;*x;
A well known fast algorithm is based on FFT :
 (1) fold column-wisely the 2*N rows into N rows
 (2) complex arrange the N rows into N/2 rows
 (3) pre-twiddle, N/2-point complex fft, post-twiddle
 (4) reorder to form the MDCT spectrum
in fact, (2)-(4) is a fast DCT-IV algorithm.

Implementation of the algorithm can be found in faac, but a little bit mess to extract for
standalone use, and I ran into that problem. So I wrote some c codes to implement
MDCT/IMDCT for any length that is a multiple of 4. Hopefully they will be useful to people
here.

I benchmarked the codes using 3 FFT routines, FFT in faac, kiss_fft, and the awful FFTW.
MDCT based on FFTW is the fastest, 2048-point MDCT single precision 10^5 times in 1.54s,
about 50% of FFT in faac on my Petium IV 3G Hz.

An author of the FFTW, Steven G. Johnson, has a hard-coded fixed size MDCT of 256 input
samples(http://jdj.mit.edu/~stevenj/mdct_128nr.c). My code is 13% slower than his.


Using the codes is very simple:
 (1) init (declare first &quot;extern void* mdctf_init(int)&quot;)
       void* m_plan = mdctf_init(N);
 (2) run mdct/imdct as many times as you wish
       mdctf(freq, time, m_plan);
 (3) free
       mdctf_free(m_plan);

Of course you need the the fftw library. On Linux, gcc options are &quot;-O2 -lfftw3f -lm&quot;.
This is single precision.


Enjoy :)
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*********************************************************</span>
<span class="cm">  MDCT/IMDCT of 4x length, Single Precision, based on FFTW</span>
<span class="cm">  shuhua dot zhang at gmail dot com</span>
<span class="cm">  Dept. of E.E., Tsinghua University</span>
<span class="cm"> *********************************************************/</span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fftw3.h&gt;</span><span class="cp"></span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span>              <span class="n">N</span><span class="p">;</span>              <span class="c1">// Number of time data points</span>
    <span class="kt">float</span><span class="o">*</span>           <span class="n">twiddle</span><span class="p">;</span>        <span class="c1">// Twiddle factor</span>
    <span class="n">fftwf_complex</span><span class="o">*</span>   <span class="n">fft_in</span><span class="p">;</span>         <span class="c1">// fft workspace, input</span>
    <span class="n">fftwf_complex</span><span class="o">*</span>   <span class="n">fft_out</span><span class="p">;</span>        <span class="c1">// fft workspace, output</span>
    <span class="n">fftwf_plan</span>       <span class="n">fft_plan</span><span class="p">;</span>       <span class="c1">// fft configuration</span>
<span class="p">}</span> <span class="n">mdctf_plan</span><span class="p">;</span>


<span class="n">mdctf_plan</span><span class="o">*</span> <span class="nf">mdctf_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">mdctf_free</span><span class="p">(</span><span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">mdctf</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">mdct_line</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">time_signal</span><span class="p">,</span> <span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">imdctf</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">time_signal</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">mdct_line</span><span class="p">,</span> <span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">);</span>


<span class="n">mdctf_plan</span><span class="o">*</span> <span class="nf">mdctf_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">omiga</span><span class="p">,</span> <span class="n">scale</span><span class="p">;</span>
    <span class="kt">int</span>    <span class="n">n</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span> <span class="mh">0x00</span> <span class="o">!=</span> <span class="p">(</span><span class="n">N</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot; Expecting N a multiple of 4</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">m_plan</span> <span class="o">=</span> <span class="p">(</span><span class="n">mdctf_plan</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">mdctf_plan</span><span class="p">));</span>

    <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">;</span>

    <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">twiddle</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="p">(</span><span class="mf">8.f</span> <span class="o">*</span> <span class="n">N</span><span class="p">);</span>
    <span class="n">omiga</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="n">N</span><span class="p">;</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.f</span> <span class="o">/</span> <span class="n">N</span><span class="p">));</span>
    <span class="k">for</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">twiddle</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">omiga</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">));</span>
        <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">twiddle</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">omiga</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_in</span>   <span class="o">=</span> <span class="p">(</span><span class="n">fftwf_complex</span><span class="o">*</span><span class="p">)</span> <span class="n">fftwf_malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fftwf_complex</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_out</span>  <span class="o">=</span> <span class="p">(</span><span class="n">fftwf_complex</span><span class="o">*</span><span class="p">)</span> <span class="n">fftwf_malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">fftwf_complex</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_plan</span> <span class="o">=</span> <span class="n">fftwf_plan_dft_1d</span><span class="p">(</span><span class="n">N</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">,</span>
                                         <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_in</span><span class="p">,</span>
                                         <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_out</span><span class="p">,</span>
                                         <span class="n">FFTW_FORWARD</span><span class="p">,</span>
                                         <span class="n">FFTW_MEASURE</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">m_plan</span><span class="p">;</span>

<span class="p">}</span>


<span class="kt">void</span> <span class="nf">mdctf_free</span><span class="p">(</span><span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">fftwf_destroy_plan</span><span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_plan</span><span class="p">);</span>
    <span class="n">fftwf_free</span><span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_in</span><span class="p">);</span>
    <span class="n">fftwf_free</span><span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_out</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">twiddle</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">m_plan</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">mdctf</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">mdct_line</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">time_signal</span><span class="p">,</span> <span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span>  <span class="o">*</span><span class="n">xr</span><span class="p">,</span> <span class="o">*</span><span class="n">xi</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">i0</span><span class="p">;</span>
    <span class="kt">float</span>  <span class="o">*</span><span class="n">cos_tw</span><span class="p">,</span> <span class="o">*</span><span class="n">sin_tw</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">N4</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">N34</span><span class="p">,</span> <span class="n">N54</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>

    <span class="n">N4</span>  <span class="o">=</span> <span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">N2</span>  <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N4</span><span class="p">;</span>
    <span class="n">N34</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">N4</span><span class="p">;</span>
    <span class="n">N54</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">N4</span><span class="p">;</span>

    <span class="n">cos_tw</span> <span class="o">=</span> <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">twiddle</span><span class="p">;</span>
    <span class="n">sin_tw</span> <span class="o">=</span> <span class="n">cos_tw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="cm">/* odd/even folding and pre-twiddle */</span>
    <span class="n">xr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span> <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_in</span><span class="p">;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N4</span><span class="p">;</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N34</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N34</span><span class="o">+</span><span class="n">n</span><span class="p">];</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N4</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>    <span class="o">-</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N4</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">];</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">xr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N2</span><span class="p">;</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N34</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">time_signal</span><span class="p">[</span><span class="o">-</span><span class="n">N4</span><span class="o">+</span><span class="n">n</span><span class="p">];</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N4</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>    <span class="o">+</span> <span class="n">time_signal</span><span class="p">[</span><span class="n">N54</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">];</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">xr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* complex FFT of N/4 long */</span>
    <span class="n">fftwf_execute</span><span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_plan</span><span class="p">);</span>

    <span class="cm">/* post-twiddle */</span>
    <span class="n">xr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span> <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_out</span><span class="p">;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N2</span><span class="p">;</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">xr</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">mdct_line</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>      <span class="o">=</span> <span class="o">-</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">mdct_line</span><span class="p">[</span><span class="n">N2</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">imdctf</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span> <span class="n">time_signal</span><span class="p">,</span> <span class="kt">float</span><span class="o">*</span> <span class="n">mdct_line</span><span class="p">,</span> <span class="n">mdctf_plan</span><span class="o">*</span> <span class="n">m_plan</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span>  <span class="o">*</span><span class="n">xr</span><span class="p">,</span> <span class="o">*</span><span class="n">xi</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">i0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">i1</span><span class="p">;</span>
    <span class="kt">float</span>  <span class="o">*</span><span class="n">cos_tw</span><span class="p">,</span> <span class="o">*</span><span class="n">sin_tw</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">N4</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">N34</span><span class="p">,</span> <span class="n">N54</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>

    <span class="n">N4</span>  <span class="o">=</span> <span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">N2</span>  <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N4</span><span class="p">;</span>
    <span class="n">N34</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">N4</span><span class="p">;</span>
    <span class="n">N54</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">N4</span><span class="p">;</span>

    <span class="n">cos_tw</span> <span class="o">=</span> <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">twiddle</span><span class="p">;</span>
    <span class="n">sin_tw</span> <span class="o">=</span> <span class="n">cos_tw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

       <span class="cm">/* pre-twiddle */</span>
    <span class="n">xr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span> <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_in</span><span class="p">;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N2</span><span class="p">;</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r0</span> <span class="o">=</span>  <span class="n">mdct_line</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">i0</span> <span class="o">=</span>  <span class="n">mdct_line</span><span class="p">[</span><span class="n">N2</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">];</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

            <span class="n">xr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.f</span> <span class="o">*</span> <span class="p">(</span><span class="n">i0</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">c</span><span class="p">);</span>
        <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.f</span> <span class="o">*</span> <span class="p">(</span><span class="n">i0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* complex FFT of N/4 long */</span>
    <span class="n">fftwf_execute</span><span class="p">(</span><span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_plan</span><span class="p">);</span>

    <span class="cm">/* odd/even expanding and post-twiddle */</span>
    <span class="n">xr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="p">)</span> <span class="n">m_plan</span><span class="o">-&gt;</span><span class="n">fft_out</span><span class="p">;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">xr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N4</span><span class="p">;</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">xr</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">s</span> <span class="o">-</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>

        <span class="n">time_signal</span><span class="p">[</span><span class="n">N34</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span>  <span class="n">r1</span><span class="p">;</span>
        <span class="n">time_signal</span><span class="p">[</span><span class="n">N34</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>   <span class="o">=</span>  <span class="n">r1</span><span class="p">;</span>
        <span class="n">time_signal</span><span class="p">[</span><span class="n">N4</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>    <span class="o">=</span>  <span class="n">i1</span><span class="p">;</span>
        <span class="n">time_signal</span><span class="p">[</span><span class="n">N4</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span>  <span class="o">=</span> <span class="o">-</span><span class="n">i1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">N2</span><span class="p">;</span> <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">xr</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">cos_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">sin_tw</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>

        <span class="n">r1</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="n">s</span> <span class="o">-</span> <span class="n">i0</span> <span class="o">*</span> <span class="n">c</span><span class="p">;</span>

        <span class="n">time_signal</span><span class="p">[</span><span class="n">N34</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span>  <span class="n">r1</span><span class="p">;</span>
        <span class="n">time_signal</span><span class="p">[</span><span class="o">-</span><span class="n">N4</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="n">r1</span><span class="p">;</span>
        <span class="n">time_signal</span><span class="p">[</span><span class="n">N4</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>    <span class="o">=</span>  <span class="n">i1</span><span class="p">;</span>
        <span class="n">time_signal</span><span class="p">[</span><span class="n">N54</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span>  <span class="n">i1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-08-05 14:42:44</p></li>
<li><p><strong>By</strong>: none</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hi, your &quot;freq, time&quot; example in your comments feed into the main function as &quot;mdct_line, time_signal&quot; float pointers.
Can you explain what these are?
Thanks
D
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-08-11 05:11:59</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;gnahz&#46;auhuhs">moc<span>&#46;</span>liamg<span>&#64;</span>gnahz<span>&#46;</span>auhuhs</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hi,

  Here I past a complete test bench for the MDCT/IMDCT routine. Suppose the MDCT/IMDCT routines named &quot;mdctf.c&quot; and the following benchmark routine named &quot;ftestbench.c&quot;, the gcc compilation command will be
  gcc -o ftestbench -O2 ftestbench.c mdctf.c -lfftw3f -lm

Shuhua Zhang, Aug. 11, 2009


/* benchmark MDCT and IMDCT, floating point */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;math.h&gt;
#include &lt;time.h&gt;

extern void* mdctf_init(int);

int main(int argc, char* argv[])
{
    int N, r, i;
    float* time;
    float* freq;
    void* m_plan;
    clock_t t0, t1;

    if(3 != argc)
    {
        fprintf(stderr, &quot; Usage: %s &lt;MDCT_SIZE&gt; &lt;run_times&gt; \n&quot;, argv[0]);
        return -1;
    }

    sscanf(argv[1], &quot;%d&quot;, &amp;N);
    sscanf(argv[2], &quot;%d&quot;, &amp;r);

    time = (float*)malloc(sizeof(float) * N);
    freq = (float*)malloc(sizeof(float) * (N &gt;&gt; 1));
    for(i = 0; i &lt; N; i++)
        time[i] = 2.f * rand() / RAND_MAX - 1.f;

    /* MDCT/IMDCT floating point initialization */
    m_plan = mdctf_init(N);
    if(NULL == m_plan)
    {
            free(freq);
            free(time);
            return -1;
    }

    /* benchmark MDCT floating point*/
    t0 = clock();
    for(i = 0; i &lt; r; i++)
        mdctf(freq, time, m_plan);
    t1 = clock();
    fprintf(stdout, &quot;MDCT of size %d, float, running %d times, uses %.2e s\n&quot;,
            N, r, (float) (t1 - t0) / CLOCKS_PER_SEC);

    /* benchmark IMDCT floating point*/
    t0 = clock();
    for(i = 0; i &lt; r; i++)
        imdctf(time, freq, m_plan);
    t1 = clock();
    fprintf(stdout, &quot;IMDCT of size %d, float, running %d times, uses %.2e s\n&quot;,
            N, r, (float) (t1 - t0) / CLOCKS_PER_SEC);

    /* free MDCT/IMDCT workspace */
    mdctf_free(m_plan);

    free(freq);
    free(time);

    return 0;

}
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="196-moog-filter.html" class="btn btn-neutral float-right" title="Moog Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="28-lowpass-filter-for-parameter-edge-filtering.html" class="btn btn-neutral float-left" title="Lowpass filter for parameter edge filtering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>