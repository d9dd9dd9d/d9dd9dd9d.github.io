

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Butterworth Optimized C++ Class &mdash; Musicdsp.org  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="C++ class implementation of RBJ Filters" href="128-c-class-implementation-of-rbj-filters.html" />
    <link rel="prev" title="Biquad, Butterworth, Chebyshev N-order, M-channel optimized filters" href="276-biquad-butterworth-chebyshev-n-order-m-channel-optimized-filters.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Musicdsp.org
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Filters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="257-1-pole-lpf-for-smooth-parameter-changes.html">1 pole LPF for smooth parameter changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="185-1-rc-and-c-filter.html">1-RC and C filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="72-18db-oct-resonant-3-pole-lpf-with-tanh-dist.html">18dB/oct resonant 3 pole LPF with tanh() dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="85-1st-and-2nd-order-pink-noise-filters.html">1st and 2nd order pink noise filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="236-3-band-equaliser.html">3 Band Equaliser</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-303-type-filter-with-saturation.html">303 type filter with saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="266-4th-order-linkwitz-riley-filters.html">4th order Linkwitz-Riley filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-all-pass-filters-a-good-explanation.html">All-Pass Filters, a good explanation</a></li>
<li class="toctree-l2"><a class="reference internal" href="181-another-4-pole-lowpass.html">Another 4-pole lowpass…</a></li>
<li class="toctree-l2"><a class="reference internal" href="235-bass-booster.html">Bass Booster</a></li>
<li class="toctree-l2"><a class="reference internal" href="64-biquad-c-code.html">Biquad C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="276-biquad-butterworth-chebyshev-n-order-m-channel-optimized-filters.html">Biquad, Butterworth, Chebyshev N-order, M-channel  optimized filters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Butterworth Optimized C++ Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="128-c-class-implementation-of-rbj-filters.html">C++ class implementation of RBJ Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="226-c-weighed-filter.html">C-Weighed Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="131-cascaded-resonant-lp-hp-filter.html">Cascaded resonant lp/hp filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="180-cool-sounding-lowpass-with-decibel-measured-resonance.html">Cool Sounding Lowpass With Decibel Measured Resonance</a></li>
<li class="toctree-l2"><a class="reference internal" href="135-dc-filter.html">DC filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="225-delphi-class-implementation-of-the-rbj-filters.html">Delphi Class implementation of the RBJ filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="122-digital-riaa-equalization-filter-coefficients.html">Digital RIAA equalization filter coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="275-direct-form-ii-biquad.html">Direct Form II biquad</a></li>
<li class="toctree-l2"><a class="reference internal" href="174-direct-form-ii.html">Direct form II</a></li>
<li class="toctree-l2"><a class="reference internal" href="214-fast-downsampling-with-antialiasing.html">Fast Downsampling With Antialiasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="110-formant-filter.html">Formant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="179-frequency-warped-fir-lattice.html">Frequency warped FIR lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="195-hilbert-filter-coefficient-calculation.html">Hilbert Filter Coefficient Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="231-hiqh-quality-2-decimators.html">Hiqh quality /2 decimators</a></li>
<li class="toctree-l2"><a class="reference internal" href="141-karlsen.html">Karlsen</a></li>
<li class="toctree-l2"><a class="reference internal" href="240-karlsen-fast-ladder.html">Karlsen Fast Ladder</a></li>
<li class="toctree-l2"><a class="reference internal" href="38-lp-and-hp-filter.html">LP and HP filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="229-lpf-24db-oct.html">LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="28-lowpass-filter-for-parameter-edge-filtering.html">Lowpass filter for parameter edge filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="270-mdct-and-imdct-based-on-fftw3.html">MDCT and IMDCT based on FFTW3</a></li>
<li class="toctree-l2"><a class="reference internal" href="196-moog-filter.html">Moog Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="24-moog-vcf.html">Moog VCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="25-moog-vcf-variation-1.html">Moog VCF, variation 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="26-moog-vcf-variation-2.html">Moog VCF, variation 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="35-notch-filter.html">Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="116-one-pole-lp-and-hp.html">One pole LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="237-one-pole-filter-lp-and-hp.html">One pole filter, LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="117-one-pole-one-zero-lp-hp.html">One pole, one zero LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="118-one-zero-lp-hp.html">One zero, LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="263-one-liner-iir-filters-1st-order.html">One-Liner IIR Filters (1st order)</a></li>
<li class="toctree-l2"><a class="reference internal" href="265-output-limiter-using-envelope-follower-in-c.html">Output Limiter using Envelope Follower in C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="130-peak-notch-filter.html">Peak/Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="253-perfect-lp4-filter.html">Perfect LP4 filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="76-pink-noise-filter.html">Pink noise filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="251-plot-filter-analyze-filter-characteristics.html">Plot Filter (Analyze filter characteristics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="218-plotting-r-b-j-equalisers-in-excel.html">Plotting R B-J Equalisers in Excel</a></li>
<li class="toctree-l2"><a class="reference internal" href="39-polyphase-filters.html">Polyphase Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="223-polyphase-filters-delphi.html">Polyphase Filters (Delphi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="247-poor-man-s-fiwiz.html">Poor Man’s FIWIZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="34-prewarping.html">Prewarping</a></li>
<li class="toctree-l2"><a class="reference internal" href="197-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="198-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="209-remez-exchange-algorithm-parks-mcclellan.html">Remez Exchange Algorithm (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="208-remez-remez-parks-mcclellan.html">Remez Remez (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="27-resonant-iir-lowpass-12db-oct.html">Resonant IIR lowpass (12dB/oct)</a></li>
<li class="toctree-l2"><a class="reference internal" href="29-resonant-filter.html">Resonant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="33-resonant-low-pass-filter.html">Resonant low pass filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="176-reverb-filter-generator.html">Reverb Filter Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="267-simple-tilt-equalizer.html">Simple Tilt equalizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="259-simple-biquad-filter-from-apple-com.html">Simple biquad filter from apple.com</a></li>
<li class="toctree-l2"><a class="reference internal" href="258-spuc-s-open-source-filters.html">Spuc’s open source filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="142-state-variable-filter-chamberlin-version.html">State Variable Filter (Chamberlin version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="92-state-variable-filter-double-sampled-stable.html">State Variable Filter (Double Sampled, Stable)</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-state-variable.html">State variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="145-stilson-s-moog-filter-code.html">Stilson’s Moog filter code</a></li>
<li class="toctree-l2"><a class="reference internal" href="65-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="66-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="232-type-lpf-24db-oct.html">Type : LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="32-various-biquad-filters.html">Various Biquad filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="194-windowed-sinc-fir-generator.html">Windowed Sinc FIR Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="37-zoelzer-biquad-filters.html">Zoelzer biquad filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Musicdsp.org</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Filters</a> &raquo;</li>
        
      <li>Butterworth Optimized C++ Class</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Filters/243-butterworth-optimized-c-class.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="butterworth-optimized-c-class">
<h1>Butterworth Optimized C++ Class<a class="headerlink" href="#butterworth-optimized-c-class" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> neotec</p></li>
<li><p><strong>Type:</strong> 24db Resonant Lowpass</p></li>
<li><p><strong>Created:</strong> 2007-01-20 22:41:06</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This ist exactly the same as posted by &quot;Zxform&quot; (filters004.txt). The only difference is,
that this version is an optimized one.

Parameters:
Cutoff [0.f -&gt; Nyquist.f]
Resonance [0.f -&gt; 1.f]

There are some minima and maxima defined, to make ist sound nice in all situations. This
class is part of some of my VST Plugins, and works well and executes fast.
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// FilterButterworth24db.h</span>

<span class="cp">#pragma once</span>

<span class="k">class</span> <span class="nc">CFilterButterworth24db</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">CFilterButterworth24db</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
    <span class="o">~</span><span class="n">CFilterButterworth24db</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">SetSampleRate</span><span class="p">(</span><span class="kt">float</span> <span class="n">fs</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">Set</span><span class="p">(</span><span class="kt">float</span> <span class="n">cutoff</span><span class="p">,</span> <span class="kt">float</span> <span class="n">q</span><span class="p">);</span>
    <span class="kt">float</span> <span class="nf">Run</span><span class="p">(</span><span class="kt">float</span> <span class="n">input</span><span class="p">);</span>

<span class="k">private</span><span class="o">:</span>
    <span class="kt">float</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">coef0</span><span class="p">,</span> <span class="n">coef1</span><span class="p">,</span> <span class="n">coef2</span><span class="p">,</span> <span class="n">coef3</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">history1</span><span class="p">,</span> <span class="n">history2</span><span class="p">,</span> <span class="n">history3</span><span class="p">,</span> <span class="n">history4</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">gain</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">min_cutoff</span><span class="p">,</span> <span class="n">max_cutoff</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// FilterButterworth24db.cpp</span>

<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>

<span class="cp">#define BUDDA_Q_SCALE 6.f</span>

<span class="cp">#include</span> <span class="cpf">&quot;FilterButterworth24db.h&quot;</span><span class="cp"></span>

<span class="n">CFilterButterworth24db</span><span class="o">::</span><span class="n">CFilterButterworth24db</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history1</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history2</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history3</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history4</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">SetSampleRate</span><span class="p">(</span><span class="mf">44100.f</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">Set</span><span class="p">(</span><span class="mf">22050.f</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">CFilterButterworth24db</span><span class="o">::~</span><span class="n">CFilterButterworth24db</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CFilterButterworth24db</span><span class="o">::</span><span class="n">SetSampleRate</span><span class="p">(</span><span class="kt">float</span> <span class="n">fs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">4.f</span> <span class="o">*</span> <span class="n">atanf</span><span class="p">(</span><span class="mf">1.f</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">t0</span> <span class="o">=</span> <span class="mf">4.f</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">*</span> <span class="n">fs</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">t1</span> <span class="o">=</span> <span class="mf">8.f</span> <span class="o">*</span> <span class="n">fs</span> <span class="o">*</span> <span class="n">fs</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">t2</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">fs</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">t3</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">fs</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">min_cutoff</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">*</span> <span class="mf">0.01f</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">max_cutoff</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">*</span> <span class="mf">0.45f</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">CFilterButterworth24db</span><span class="o">::</span><span class="n">Set</span><span class="p">(</span><span class="kt">float</span> <span class="n">cutoff</span><span class="p">,</span> <span class="kt">float</span> <span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cutoff</span> <span class="o">&lt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">min_cutoff</span><span class="p">)</span>
            <span class="n">cutoff</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">min_cutoff</span><span class="p">;</span>
    <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">cutoff</span> <span class="o">&gt;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">max_cutoff</span><span class="p">)</span>
            <span class="n">cutoff</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">max_cutoff</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">0.f</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
    <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">1.f</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mf">1.f</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">wp</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t2</span> <span class="o">*</span> <span class="n">tanf</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">t3</span> <span class="o">*</span> <span class="n">cutoff</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">bd</span><span class="p">,</span> <span class="n">bd_tmp</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">;</span>

    <span class="n">q</span> <span class="o">*=</span> <span class="n">BUDDA_Q_SCALE</span><span class="p">;</span>
    <span class="n">q</span> <span class="o">+=</span> <span class="mf">1.f</span><span class="p">;</span>

    <span class="n">b1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.765367f</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">wp</span><span class="p">;</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">/</span> <span class="p">(</span><span class="n">wp</span> <span class="o">*</span> <span class="n">wp</span><span class="p">);</span>

    <span class="n">bd_tmp</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t0</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">+</span> <span class="mf">1.f</span><span class="p">;</span>

    <span class="n">bd</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">/</span> <span class="p">(</span><span class="n">bd_tmp</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t2</span> <span class="o">*</span> <span class="n">b1</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">=</span> <span class="n">bd</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.f</span> <span class="o">-</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t1</span> <span class="o">*</span> <span class="n">b2</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef0</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef2</span> <span class="o">*</span> <span class="n">bd</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef1</span> <span class="o">=</span> <span class="p">(</span><span class="n">bd_tmp</span> <span class="o">-</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t2</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bd</span><span class="p">;</span>

    <span class="n">b1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.847759f</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">wp</span><span class="p">;</span>

    <span class="n">bd</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">/</span> <span class="p">(</span><span class="n">bd_tmp</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t2</span> <span class="o">*</span> <span class="n">b1</span><span class="p">);</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">*=</span> <span class="n">bd</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef2</span> <span class="o">*=</span> <span class="n">bd</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef3</span> <span class="o">=</span> <span class="p">(</span><span class="n">bd_tmp</span> <span class="o">-</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">t2</span> <span class="o">*</span> <span class="n">b1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bd</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">CFilterButterworth24db</span><span class="o">::</span><span class="n">Run</span><span class="p">(</span><span class="kt">float</span> <span class="n">input</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">float</span> <span class="n">output</span> <span class="o">=</span> <span class="n">input</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">new_hist</span><span class="p">;</span>

    <span class="n">output</span> <span class="o">-=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history1</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef0</span><span class="p">;</span>
    <span class="n">new_hist</span> <span class="o">=</span> <span class="n">output</span> <span class="o">-</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history2</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef1</span><span class="p">;</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">new_hist</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history1</span> <span class="o">*</span> <span class="mf">2.f</span><span class="p">;</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history2</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history2</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history1</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history1</span> <span class="o">=</span> <span class="n">new_hist</span><span class="p">;</span>

    <span class="n">output</span> <span class="o">-=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history3</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef2</span><span class="p">;</span>
    <span class="n">new_hist</span> <span class="o">=</span> <span class="n">output</span> <span class="o">-</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history4</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">coef3</span><span class="p">;</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">new_hist</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history3</span> <span class="o">*</span> <span class="mf">2.f</span><span class="p">;</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history4</span><span class="p">;</span>

    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history4</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">history3</span><span class="p">;</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">history3</span> <span class="o">=</span> <span class="n">new_hist</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-22 18:38:23</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;bob">moc<span>&#46;</span>oohay<span>&#64;</span>bob</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This sounds really nice, especially with resonance. Although it becomes unstable below 4K (at 44100 s/r), which explains why the min_cutoff value has been set quite high. Would using doubles help stabilise it?
Also, I can&#39;t figure out how to get a high pass out of this, can anybody help?
Cheers.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-22 19:54:21</p></li>
<li><p><strong>By</strong>: neotec</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I have checked the peak output of this filter and especially for low frequences ... there is a simple fix, which makes it sound better with low frequences: change the line in Set(...) that reads &#39;this-&gt;gain = bd * 0.5f;&#39; to &#39;this-&gt;gain = bd;&#39;
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-22 22:27:11</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;bob">moc<span>&#46;</span>oohay<span>&#64;</span>bob</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Thanks for the quick reply. I&#39;ve tried your change and it&#39;s made a slight tonal difference here, but the tests were not particularly scientific. I&#39;ve discovered more detail in the problem, and it&#39;s one that has been commented on with other filters: If I sweep the filter quickly up or down the low frequencies it blows out really badly, even with zero Q. I&#39;m new to filter math, so excuse my ignorance if this is a common thing with Butterworth.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-23 12:54:03</p></li>
<li><p><strong>By</strong>: neotec</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Yep ... this filter reacts very extreme on fast cutoff changes. I&#39;ve added a function to my VST Synthesizer, which &#39;fades&#39; the cutoff value from actual value to the desired one in about 0.05 seconds. My modulation envelopes do have similar restrictions concerning speed.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-23 16:35:51</p></li>
<li><p><strong>By</strong>: neotec</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>If you want to know how this filter sounds, visit the kvraudio forum, and search here: &quot;KVR Forum » Instruments&quot; for &quot;Cetone VST Plugins&quot;.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-29 21:57:52</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;erehwon&#37;&#52;&#48;ydobon">moc<span>&#46;</span>erehwon<span>&#64;</span>ydobon</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I&#39;m wondering about that tanh in the &quot;Set.&quot;

Could replace with a pade appromimation, maybe. What is the range of inputs going into it?

In other words, how small and big does this get?...

this-&gt;t3 * cutoff
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-29 22:06:28</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;dniftnacuoyerehwemos&#37;&#52;&#48;tsaot">moc<span>&#46;</span>dniftnacuoyerehwemos<span>&#64;</span>tsaot</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Possible small optimization. It depends on how smart your compiler is, but sections like this...

    output = new_hist + this-&gt;history3 * 2.f;
    output += this-&gt;history4;

can be changed to this to change the multiply to an addition:

output = this-&gt;history3;
output += output+new_Hist+this-&gt;history4;
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-01-30 03:05:05</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;dniftnacuoyerehwemos&#37;&#52;&#48;tsaot">moc<span>&#46;</span>dniftnacuoyerehwemos<span>&#64;</span>tsaot</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>While I&#39;m at it, one of these divisions can easily be switched to a multiply...

 b1 = (1.847759f / q) / wp;

b1=(1.847759f/(q*wp);
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-02-04 19:32:55</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;bob">moc<span>&#46;</span>oohay<span>&#64;</span>bob</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Four times oversampling removes the problems with fast cut-off sweeps at low values.
This filter has the same shape as a normal biquad filter, with a more pronounced resonance boost.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-01-12 20:42:34</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:gro&#46;lortnocdnim&#37;&#52;&#48;gro&#46;psdcisum">gro<span>&#46;</span>lortnocdnim<span>&#64;</span>gro<span>&#46;</span>psdcisum</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Why would oversampling solve the problem? If you over-sample, the poles have to reach even further into the relative frequencies, and stability would become more of a problem AFAICT.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-01-21 14:58:55</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;bob">moc<span>&#46;</span>oohay<span>&#64;</span>bob</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>It just seems to. If you 4X over-sample, then it gives it a 4X chance to recover from each sweep change, presuming you&#39;re not changing the filter cut-off at 4X also.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2008-01-25 14:46:31</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:erehwon&#46;ku&#46;oc&#46;snosrapsd&#37;&#52;&#48;psdcisum">erehwon<span>&#46;</span>ku<span>&#46;</span>oc<span>&#46;</span>snosrapsd<span>&#64;</span>psdcisum</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>thing is with 4X oversampling on this is that you&#39;ll be reducing precision on omega (wp here), and so should probably shift to double rather than float to help accuracy.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-04-24 02:48:07</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liam&#37;&#52;&#48;ttocs">moc<span>&#46;</span>liam<span>&#64;</span>ttocs</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Did anyone figure out how to get a high pass out of this?

Thanks!
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="128-c-class-implementation-of-rbj-filters.html" class="btn btn-neutral float-right" title="C++ class implementation of RBJ Filters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="276-biquad-butterworth-chebyshev-n-order-m-channel-optimized-filters.html" class="btn btn-neutral float-left" title="Biquad, Butterworth, Chebyshev N-order, M-channel optimized filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>