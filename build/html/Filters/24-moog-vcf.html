

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Moog VCF &mdash; Musicdsp.org  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Moog VCF, variation 1" href="25-moog-vcf-variation-1.html" />
    <link rel="prev" title="Moog Filter" href="196-moog-filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Musicdsp.org
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Filters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="257-1-pole-lpf-for-smooth-parameter-changes.html">1 pole LPF for smooth parameter changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="185-1-rc-and-c-filter.html">1-RC and C filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="72-18db-oct-resonant-3-pole-lpf-with-tanh-dist.html">18dB/oct resonant 3 pole LPF with tanh() dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="85-1st-and-2nd-order-pink-noise-filters.html">1st and 2nd order pink noise filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="236-3-band-equaliser.html">3 Band Equaliser</a></li>
<li class="toctree-l2"><a class="reference internal" href="30-303-type-filter-with-saturation.html">303 type filter with saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="266-4th-order-linkwitz-riley-filters.html">4th order Linkwitz-Riley filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-all-pass-filters-a-good-explanation.html">All-Pass Filters, a good explanation</a></li>
<li class="toctree-l2"><a class="reference internal" href="181-another-4-pole-lowpass.html">Another 4-pole lowpass…</a></li>
<li class="toctree-l2"><a class="reference internal" href="235-bass-booster.html">Bass Booster</a></li>
<li class="toctree-l2"><a class="reference internal" href="64-biquad-c-code.html">Biquad C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="276-biquad-butterworth-chebyshev-n-order-m-channel-optimized-filters.html">Biquad, Butterworth, Chebyshev N-order, M-channel  optimized filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="243-butterworth-optimized-c-class.html">Butterworth Optimized C++ Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="128-c-class-implementation-of-rbj-filters.html">C++ class implementation of RBJ Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="226-c-weighed-filter.html">C-Weighed Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="131-cascaded-resonant-lp-hp-filter.html">Cascaded resonant lp/hp filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="180-cool-sounding-lowpass-with-decibel-measured-resonance.html">Cool Sounding Lowpass With Decibel Measured Resonance</a></li>
<li class="toctree-l2"><a class="reference internal" href="135-dc-filter.html">DC filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="225-delphi-class-implementation-of-the-rbj-filters.html">Delphi Class implementation of the RBJ filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="122-digital-riaa-equalization-filter-coefficients.html">Digital RIAA equalization filter coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="275-direct-form-ii-biquad.html">Direct Form II biquad</a></li>
<li class="toctree-l2"><a class="reference internal" href="174-direct-form-ii.html">Direct form II</a></li>
<li class="toctree-l2"><a class="reference internal" href="214-fast-downsampling-with-antialiasing.html">Fast Downsampling With Antialiasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="110-formant-filter.html">Formant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="179-frequency-warped-fir-lattice.html">Frequency warped FIR lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="195-hilbert-filter-coefficient-calculation.html">Hilbert Filter Coefficient Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="231-hiqh-quality-2-decimators.html">Hiqh quality /2 decimators</a></li>
<li class="toctree-l2"><a class="reference internal" href="141-karlsen.html">Karlsen</a></li>
<li class="toctree-l2"><a class="reference internal" href="240-karlsen-fast-ladder.html">Karlsen Fast Ladder</a></li>
<li class="toctree-l2"><a class="reference internal" href="38-lp-and-hp-filter.html">LP and HP filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="229-lpf-24db-oct.html">LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="28-lowpass-filter-for-parameter-edge-filtering.html">Lowpass filter for parameter edge filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="270-mdct-and-imdct-based-on-fftw3.html">MDCT and IMDCT based on FFTW3</a></li>
<li class="toctree-l2"><a class="reference internal" href="196-moog-filter.html">Moog Filter</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Moog VCF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="25-moog-vcf-variation-1.html">Moog VCF, variation 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="26-moog-vcf-variation-2.html">Moog VCF, variation 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="35-notch-filter.html">Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="116-one-pole-lp-and-hp.html">One pole LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="237-one-pole-filter-lp-and-hp.html">One pole filter, LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="117-one-pole-one-zero-lp-hp.html">One pole, one zero LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="118-one-zero-lp-hp.html">One zero, LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="263-one-liner-iir-filters-1st-order.html">One-Liner IIR Filters (1st order)</a></li>
<li class="toctree-l2"><a class="reference internal" href="265-output-limiter-using-envelope-follower-in-c.html">Output Limiter using Envelope Follower in C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="130-peak-notch-filter.html">Peak/Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="253-perfect-lp4-filter.html">Perfect LP4 filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="76-pink-noise-filter.html">Pink noise filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="251-plot-filter-analyze-filter-characteristics.html">Plot Filter (Analyze filter characteristics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="218-plotting-r-b-j-equalisers-in-excel.html">Plotting R B-J Equalisers in Excel</a></li>
<li class="toctree-l2"><a class="reference internal" href="39-polyphase-filters.html">Polyphase Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="223-polyphase-filters-delphi.html">Polyphase Filters (Delphi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="247-poor-man-s-fiwiz.html">Poor Man’s FIWIZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="34-prewarping.html">Prewarping</a></li>
<li class="toctree-l2"><a class="reference internal" href="197-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="198-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="209-remez-exchange-algorithm-parks-mcclellan.html">Remez Exchange Algorithm (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="208-remez-remez-parks-mcclellan.html">Remez Remez (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="27-resonant-iir-lowpass-12db-oct.html">Resonant IIR lowpass (12dB/oct)</a></li>
<li class="toctree-l2"><a class="reference internal" href="29-resonant-filter.html">Resonant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="33-resonant-low-pass-filter.html">Resonant low pass filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="176-reverb-filter-generator.html">Reverb Filter Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="267-simple-tilt-equalizer.html">Simple Tilt equalizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="259-simple-biquad-filter-from-apple-com.html">Simple biquad filter from apple.com</a></li>
<li class="toctree-l2"><a class="reference internal" href="258-spuc-s-open-source-filters.html">Spuc’s open source filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="142-state-variable-filter-chamberlin-version.html">State Variable Filter (Chamberlin version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="92-state-variable-filter-double-sampled-stable.html">State Variable Filter (Double Sampled, Stable)</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-state-variable.html">State variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="145-stilson-s-moog-filter-code.html">Stilson’s Moog filter code</a></li>
<li class="toctree-l2"><a class="reference internal" href="65-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="66-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="232-type-lpf-24db-oct.html">Type : LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="32-various-biquad-filters.html">Various Biquad filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="194-windowed-sinc-fir-generator.html">Windowed Sinc FIR Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="37-zoelzer-biquad-filters.html">Zoelzer biquad filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Musicdsp.org</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Filters</a> &raquo;</li>
        
      <li>Moog VCF</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Filters/24-moog-vcf.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="moog-vcf">
<h1>Moog VCF<a class="headerlink" href="#moog-vcf" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> CSound source code, Stilson/Smith CCRMA paper.</p></li>
<li><p><strong>Type:</strong> 24db resonant lowpass</p></li>
<li><p><strong>Created:</strong> 2002-01-17 02:02:40</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Digital approximation of Moog VCF. Fairly easy to calculate coefficients, fairly easy to
process algorithm, good sound.
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">//Init</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">cutoff</span> <span class="n">freq</span> <span class="n">in</span> <span class="n">Hz</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">sampling</span> <span class="n">frequency</span> <span class="c1">//(e.g. 44100Hz)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">resonance</span> <span class="p">[</span><span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1">//(minimum - maximum)</span>

<span class="n">f</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cutoff</span> <span class="o">/</span> <span class="n">fs</span><span class="p">;</span> <span class="c1">//[0 - 1]</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">3.6</span><span class="o">*</span><span class="n">f</span> <span class="o">-</span> <span class="mf">1.6</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">f</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//(Empirical tunning)</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">e</span><span class="o">^</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="mf">1.386249</span><span class="p">;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">res</span><span class="o">*</span><span class="n">scale</span><span class="p">;</span>
<span class="n">y4</span> <span class="o">=</span> <span class="n">output</span><span class="p">;</span>

<span class="n">y1</span><span class="o">=</span><span class="n">y2</span><span class="o">=</span><span class="n">y3</span><span class="o">=</span><span class="n">y4</span><span class="o">=</span><span class="n">oldx</span><span class="o">=</span><span class="n">oldy1</span><span class="o">=</span><span class="n">oldy2</span><span class="o">=</span><span class="n">oldy3</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">//Loop</span>
<span class="c1">//--Inverted feed back for corner peaking</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">input</span> <span class="o">-</span> <span class="n">r</span><span class="o">*</span><span class="n">y4</span><span class="p">;</span>

<span class="c1">//Four cascaded onepole filters (bilinear transform)</span>
<span class="n">y1</span><span class="o">=</span><span class="n">x</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">oldx</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">y1</span><span class="p">;</span>
<span class="n">y2</span><span class="o">=</span><span class="n">y1</span><span class="o">*</span><span class="n">p</span><span class="o">+</span><span class="n">oldy1</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">y2</span><span class="p">;</span>
<span class="n">y3</span><span class="o">=</span><span class="n">y2</span><span class="o">*</span><span class="n">p</span><span class="o">+</span><span class="n">oldy2</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">y3</span><span class="p">;</span>
<span class="n">y4</span><span class="o">=</span><span class="n">y3</span><span class="o">*</span><span class="n">p</span><span class="o">+</span><span class="n">oldy3</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">y4</span><span class="p">;</span>

<span class="c1">//Clipper band limited sigmoid</span>
<span class="n">y4</span> <span class="o">=</span> <span class="n">y4</span> <span class="o">-</span> <span class="p">(</span><span class="n">y4</span><span class="o">^</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">;</span>

<span class="n">oldx</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
<span class="n">oldy1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span>
<span class="n">oldy2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">;</span>
<span class="n">oldy3</span> <span class="o">=</span> <span class="n">y3</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2004-10-14 10:18:59</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ed&#46;xmg&#37;&#52;&#48;resiaknegah">ed<span>&#46;</span>xmg<span>&#64;</span>resiaknegah</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I guess the input is supposed to be between -1..1
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-02-05 00:30:04</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;erehwon&#37;&#52;&#48;ydobon">moc<span>&#46;</span>erehwon<span>&#64;</span>ydobon</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Still working on this one. Anyone notice it&#39;s got a few syntax problems? Makes me wonder if it&#39;s even been tried.

Missing parenthesis. Uses ^ twice. If I get it to work, I&#39;ll post usable code.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-02-05 17:21:53</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;erehwon&#37;&#52;&#48;tsaot">moc<span>&#46;</span>erehwon<span>&#64;</span>tsaot</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                        OK. Can&#39;t guarantee this is a 100% translation to real C++, but it does work. Aside from possible mistakes, I mucked hard with the coefficient translation, so that there is a slight difference in the numbers.

1. What kind of filter ends up with exp() in the coefficient calculation instead of the usual sin(), cos(), tan() transcendentals? If someone can explain where the e to the x comes from, I&#39;d appreciate it.

2. Since I didn&#39;t understand the origin of the coefficients, I saw the whole section as an excercise in algebra. There were some superfluous multiplications and additions.

First I implemented the e to the x with pow(). That was stupid. I switched to exp(). Hated that too. Checked out the range of inputs and decided on a common approximation for exp().

I think it&#39;s now one of the fastest filter coefficient calcs you&#39;ll see for a 4 pole. Go ahead--put the cutoff on an envelope and the q on an LFO. Hell, FM the Q if you want!

A pretty good filter. Watch the res (aka Q). Above 9, squeals like a pig. Not in a good way.

Needs more work, i think, to stand up with the better LPs in the real VST world. But an awfully cool starting place.

If I did something awful here in the translation, or if you have a question about how to use it, best to ask me (mistertoast) over at KvRaudio.com in the dev section.

I&#39;m toying with the idea of wedging this into TobyBear&#39;s filter designer as a flt file. If you manage first, let me know. I&#39;m mistertoast.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-02-05 17:22:24</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;erehwon&#37;&#52;&#48;tsaot">moc<span>&#46;</span>erehwon<span>&#64;</span>tsaot</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MoogFilter.h:

class MoogFilter
{
public:
MoogFilter();
void init();
void calc();
float process(float x);
~MoogFilter();
float getCutoff();
void setCutoff(float c);
float getRes();
void setRes(float r);
protected:
float cutoff;
float res;
float fs;
float y1,y2,y3,y4;
float oldx;
float oldy1,oldy2,oldy3;
float x;
float r;
float p;
float k;
};
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-02-05 17:22:43</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;erehwon&#37;&#52;&#48;tsaot">moc<span>&#46;</span>erehwon<span>&#64;</span>tsaot</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MoogFilter.cpp:

#include &quot;MoogFilter.h&quot;

MoogFilter::MoogFilter()
{
fs=44100.0;

init();
}

MoogFilter::~MoogFilter()
{
}

void MoogFilter::init()
{
// initialize values
y1=y2=y3=y4=oldx=oldy1=oldy2=oldy3=0;
calc();
};

void MoogFilter::calc()
{
float f = (cutoff+cutoff) / fs; //[0 - 1]
p=f*(1.8f-0.8f*f);
k=p+p-1.f;

float t=(1.f-p)*1.386249f;
float t2=12.f+t*t;
r = res*(t2+6.f*t)/(t2-6.f*t);
};

float MoogFilter::process(float input)
{
// process input
x = input - r*y4;

//Four cascaded onepole filters (bilinear transform)
y1= x*p +  oldx*p - k*y1;
y2=y1*p + oldy1*p - k*y2;
y3=y2*p + oldy2*p - k*y3;
y4=y3*p + oldy3*p - k*y4;

//Clipper band limited sigmoid
y4-=(y4*y4*y4)/6.f;

oldx = x; oldy1 = y1; oldy2 = y2; oldy3 = y3;
return y4;
}

float MoogFilter::getCutoff()
{ return cutoff; }

void MoogFilter::setCutoff(float c)
{ cutoff=c; calc(); }

float MoogFilter::getRes()
{ return res; }

void MoogFilter::setRes(float r)
{ res=r; calc(); }
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-02-05 22:04:51</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;dniftnacuoyerehwemos&#37;&#52;&#48;tsaot">moc<span>&#46;</span>dniftnacuoyerehwemos<span>&#64;</span>tsaot</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I see where the exp() comes from. It just models the resonance. I think it needs more work. At high frequencies it goes into self-oscillation much more quickly than at low frequencies.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2012-01-31 12:29:16</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;llun&#37;&#52;&#48;ved">moc<span>&#46;</span>llun<span>&#64;</span>ved</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>A much better tuning seems to be
k=2*sin(f*pi/2)-1;

(within a 0.1 cent up to 4kHz, at 44.1kHz sample rate)
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2014-03-26 21:16:08</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ten&#46;eroctsid&#37;&#52;&#48;alub">ten<span>&#46;</span>eroctsid<span>&#64;</span>alub</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This filter works and sounds fine in my VST.
I&#39;ve re-written the code using templates, which makes life easier when switching between &lt;float&gt; and &lt;double&gt; implementation.



#pragma once

namespace DistoCore
{
  template&lt;class T&gt;
  class MoogFilter
  {
  public:
    MoogFilter();
    ~MoogFilter() {};

    T getSampleRate() const { return sampleRate; }
    void setSampleRate(T fs) { sampleRate = fs; calc(); }
    T getResonance() const { return resonance; }
    void setResonance(T filterRezo) { resonance = filterRezo; calc(); }
    T getCutoff() const { return cutoff; }
    T getCutoffHz() const { return cutoff * sampleRate * 0.5; }
    void setCutoff(T filterCutoff) { cutoff = filterCutoff; calc(); }

    void init();
    void calc();
    T process(T input);
    // filter an input sample using normalized params
    T filter(T input, T cutoff, T resonance);

  protected:
    // cutoff and resonance [0 - 1]
    T cutoff;
    T resonance;
    T sampleRate;
    T fs;
    T y1,y2,y3,y4;
    T oldx;
    T oldy1,oldy2,oldy3;
    T x;
    T r;
    T p;
    T k;
  };

    /**
     * Construct Moog-filter.
     */
  template&lt;class T&gt;
  MoogFilter&lt;T&gt;::MoogFilter()
  : sampleRate(T(44100.0))
  , cutoff(T(1.0))
  , resonance(T(0.0))
  {
    init();
  }

    /**
     * Initialize filter buffers.
     */
  template&lt;class T&gt;
  void MoogFilter&lt;T&gt;::init()
  {
    // initialize values
    y1=y2=y3=y4=oldx=oldy1=oldy2=oldy3=T(0.0);
    calc();
  }

    /**
     * Calculate coefficients.
     */
  template&lt;class T&gt;
  void MoogFilter&lt;T&gt;::calc()
  {
    // TODO: replace with your constant
    const double kPi = 3.1415926535897931;

    // empirical tuning
    p = cutoff * (T(1.8) - T(0.8) * cutoff);
    // k = p + p - T(1.0);
    // A much better tuning seems to be:
    k = T(2.0) * sin(cutoff * kPi * T(0.5)) - T(1.0);

    T t1 = (T(1.0) - p) * T(1.386249);
    T t2 = T(12.0) + t1 * t1;
    r = resonance * (t2 + T(6.0) * t1) / (t2 - T(6.0) * t1);
  };

    /**
     * Process single sample.
     */
  template&lt;class T&gt;
  T MoogFilter&lt;T&gt;::process(T input)
  {
    // process input
    x = input - r * y4;

    // four cascaded one-pole filters (bilinear transform)
    y1 =  x * p + oldx  * p - k * y1;
    y2 = y1 * p + oldy1 * p - k * y2;
    y3 = y2 * p + oldy2 * p - k * y3;
    y4 = y3 * p + oldy3 * p - k * y4;

    // clipper band limited sigmoid
    y4 -= (y4 * y4 * y4) / T(6.0);

    oldx = x; oldy1 = y1; oldy2 = y2; oldy3 = y3;

    return y4;
  }

    /**
     * Filter single sample using specified params.
     */
  template&lt;class T&gt;
  T MoogFilter&lt;T&gt;::filter(T input, T filterCutoff, T filterRezo)
  {
    // set params first
    cutoff = filterCutoff;
    resonance = filterRezo;
    calc();

    return process(input);
  }
}
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2014-05-27 19:30:12</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ten&#46;enignepot&#37;&#52;&#48;derf">ten<span>&#46;</span>enignepot<span>&#64;</span>derf</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Why samplerate is missing in calc function?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2015-11-12 08:14:23</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;neslintreborkram">moc<span>&#46;</span>liamg<span>&#64;</span>neslintreborkram</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This code works great. I already had a filter in my program so sticking this in only took about an hour. The sound is just what I hoped it would be. I started putting some really gnarly low frequency  square waves through it and it returns that super chewy sound you can get from a Moog. Thanks for this.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2016-06-23 02:27:27</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;poon&#37;&#52;&#48;poon">moc<span>&#46;</span>poon<span>&#64;</span>poon</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This filter works just fine and sweeps just fine almost all the way down, cutoff easily goes below 40 Hz without issue.  I implemented it in Numerical Python (Jupyter notebook) just to be able to see it working and fiddle with it (renders sound to .wav in non realtime of course).

Cutoff sweep sounds good enough, a bit on the clean side compared to the analog Moog filters I&#39;ve heard.  It starts to ring around res=0.7 and self oscillates fine for almost any res above 1.0.   I find this filter&#39;s ringing sounds a bit tinny, thin and rather irritating though.  This seems to be a common problem in DSP filters.  It needs something, a je ne sais quoi of some kind.

Any suggestions how to modify it?
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="25-moog-vcf-variation-1.html" class="btn btn-neutral float-right" title="Moog VCF, variation 1" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="196-moog-filter.html" class="btn btn-neutral float-left" title="Moog Filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>