

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3 Band Equaliser &mdash; Notebook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="303 type filter with saturation" href="30-303-type-filter-with-saturation.html" />
    <link rel="prev" title="1st and 2nd order pink noise filters" href="85-1st-and-2nd-order-pink-noise-filters.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Notebook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Synthesis/index.html">Synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/index.html">Analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Filters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="257-1-pole-lpf-for-smooth-parameter-changes.html">1 pole LPF for smooth parameter changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="185-1-rc-and-c-filter.html">1-RC and C filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="72-18db-oct-resonant-3-pole-lpf-with-tanh-dist.html">18dB/oct resonant 3 pole LPF with tanh() dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="85-1st-and-2nd-order-pink-noise-filters.html">1st and 2nd order pink noise filters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3 Band Equaliser</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="30-303-type-filter-with-saturation.html">303 type filter with saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="266-4th-order-linkwitz-riley-filters.html">4th order Linkwitz-Riley filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="31-all-pass-filters-a-good-explanation.html">All-Pass Filters, a good explanation</a></li>
<li class="toctree-l2"><a class="reference internal" href="181-another-4-pole-lowpass.html">Another 4-pole lowpass…</a></li>
<li class="toctree-l2"><a class="reference internal" href="235-bass-booster.html">Bass Booster</a></li>
<li class="toctree-l2"><a class="reference internal" href="64-biquad-c-code.html">Biquad C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="276-biquad-butterworth-chebyshev-n-order-m-channel-optimized-filters.html">Biquad, Butterworth, Chebyshev N-order, M-channel  optimized filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="243-butterworth-optimized-c-class.html">Butterworth Optimized C++ Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="128-c-class-implementation-of-rbj-filters.html">C++ class implementation of RBJ Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="226-c-weighed-filter.html">C-Weighed Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="131-cascaded-resonant-lp-hp-filter.html">Cascaded resonant lp/hp filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="180-cool-sounding-lowpass-with-decibel-measured-resonance.html">Cool Sounding Lowpass With Decibel Measured Resonance</a></li>
<li class="toctree-l2"><a class="reference internal" href="135-dc-filter.html">DC filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="225-delphi-class-implementation-of-the-rbj-filters.html">Delphi Class implementation of the RBJ filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="122-digital-riaa-equalization-filter-coefficients.html">Digital RIAA equalization filter coefficients</a></li>
<li class="toctree-l2"><a class="reference internal" href="275-direct-form-ii-biquad.html">Direct Form II biquad</a></li>
<li class="toctree-l2"><a class="reference internal" href="174-direct-form-ii.html">Direct form II</a></li>
<li class="toctree-l2"><a class="reference internal" href="214-fast-downsampling-with-antialiasing.html">Fast Downsampling With Antialiasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="110-formant-filter.html">Formant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="179-frequency-warped-fir-lattice.html">Frequency warped FIR lattice</a></li>
<li class="toctree-l2"><a class="reference internal" href="195-hilbert-filter-coefficient-calculation.html">Hilbert Filter Coefficient Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="231-hiqh-quality-2-decimators.html">Hiqh quality /2 decimators</a></li>
<li class="toctree-l2"><a class="reference internal" href="141-karlsen.html">Karlsen</a></li>
<li class="toctree-l2"><a class="reference internal" href="240-karlsen-fast-ladder.html">Karlsen Fast Ladder</a></li>
<li class="toctree-l2"><a class="reference internal" href="38-lp-and-hp-filter.html">LP and HP filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="229-lpf-24db-oct.html">LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="28-lowpass-filter-for-parameter-edge-filtering.html">Lowpass filter for parameter edge filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="270-mdct-and-imdct-based-on-fftw3.html">MDCT and IMDCT based on FFTW3</a></li>
<li class="toctree-l2"><a class="reference internal" href="196-moog-filter.html">Moog Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="24-moog-vcf.html">Moog VCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="25-moog-vcf-variation-1.html">Moog VCF, variation 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="26-moog-vcf-variation-2.html">Moog VCF, variation 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="35-notch-filter.html">Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="116-one-pole-lp-and-hp.html">One pole LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="237-one-pole-filter-lp-and-hp.html">One pole filter, LP and HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="117-one-pole-one-zero-lp-hp.html">One pole, one zero LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="118-one-zero-lp-hp.html">One zero, LP/HP</a></li>
<li class="toctree-l2"><a class="reference internal" href="263-one-liner-iir-filters-1st-order.html">One-Liner IIR Filters (1st order)</a></li>
<li class="toctree-l2"><a class="reference internal" href="265-output-limiter-using-envelope-follower-in-c.html">Output Limiter using Envelope Follower in C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="130-peak-notch-filter.html">Peak/Notch filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="253-perfect-lp4-filter.html">Perfect LP4 filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="76-pink-noise-filter.html">Pink noise filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="251-plot-filter-analyze-filter-characteristics.html">Plot Filter (Analyze filter characteristics)</a></li>
<li class="toctree-l2"><a class="reference internal" href="218-plotting-r-b-j-equalisers-in-excel.html">Plotting R B-J Equalisers in Excel</a></li>
<li class="toctree-l2"><a class="reference internal" href="39-polyphase-filters.html">Polyphase Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="223-polyphase-filters-delphi.html">Polyphase Filters (Delphi)</a></li>
<li class="toctree-l2"><a class="reference internal" href="247-poor-man-s-fiwiz.html">Poor Man’s FIWIZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="34-prewarping.html">Prewarping</a></li>
<li class="toctree-l2"><a class="reference internal" href="197-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="198-rbj-audio-eq-cookbook.html">RBJ Audio-EQ-Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="209-remez-exchange-algorithm-parks-mcclellan.html">Remez Exchange Algorithm (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="208-remez-remez-parks-mcclellan.html">Remez Remez (Parks/McClellan)</a></li>
<li class="toctree-l2"><a class="reference internal" href="27-resonant-iir-lowpass-12db-oct.html">Resonant IIR lowpass (12dB/oct)</a></li>
<li class="toctree-l2"><a class="reference internal" href="29-resonant-filter.html">Resonant filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="33-resonant-low-pass-filter.html">Resonant low pass filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="176-reverb-filter-generator.html">Reverb Filter Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="267-simple-tilt-equalizer.html">Simple Tilt equalizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="259-simple-biquad-filter-from-apple-com.html">Simple biquad filter from apple.com</a></li>
<li class="toctree-l2"><a class="reference internal" href="258-spuc-s-open-source-filters.html">Spuc’s open source filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="142-state-variable-filter-chamberlin-version.html">State Variable Filter (Chamberlin version)</a></li>
<li class="toctree-l2"><a class="reference internal" href="92-state-variable-filter-double-sampled-stable.html">State Variable Filter (Double Sampled, Stable)</a></li>
<li class="toctree-l2"><a class="reference internal" href="23-state-variable.html">State variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="145-stilson-s-moog-filter-code.html">Stilson’s Moog filter code</a></li>
<li class="toctree-l2"><a class="reference internal" href="65-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="66-time-domain-convolution-with-o-n-log2-3.html">Time domain convolution with O(n^log2(3))</a></li>
<li class="toctree-l2"><a class="reference internal" href="232-type-lpf-24db-oct.html">Type : LPF 24dB/Oct</a></li>
<li class="toctree-l2"><a class="reference internal" href="32-various-biquad-filters.html">Various Biquad filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="194-windowed-sinc-fir-generator.html">Windowed Sinc FIR Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="37-zoelzer-biquad-filters.html">Zoelzer biquad filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Effects/index.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Other/index.html">Other</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Notebook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Filters</a> &raquo;</li>
        
      <li>3 Band Equaliser</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="band-equaliser">
<h1>3 Band Equaliser<a class="headerlink" href="#band-equaliser" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author or source:</strong> Neil C</p></li>
<li><p><strong>Created:</strong> 2006-08-29 20:34:25</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">notes</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Simple 3 band equaliser with adjustable low and high frequencies ...

Fairly fast algo, good quality output (seems to be accoustically transparent with all
gains set to 1.0)

How to use ...

1. First you need to declare a state for your eq

  EQSTATE eq;

2. Now initialise the state (we&#39;ll assume your output frequency is 48Khz)

  set_3band_state(eq,880,5000,480000);

  Your EQ bands are now as follows (approximatley!)

  low  band = 0Hz to 880Hz
  mid  band = 880Hz to 5000Hz
  high band = 5000Hz to 24000Hz

3. Set the gains to some values ...

  eq.lg = 1.5;  // Boost bass by 50%
  eq.mg = 0.75; // Cut mid by 25%
  eq.hg = 1.0;  // Leave high band alone

4. You can now EQ some samples

   out_sample = do_3band(eq,in_sample)


Have fun and mail me if any problems ...  etanza at lycos dot co dot uk


Neil C / Etanza Systems, 2006 :)
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">code</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">First</span> <span class="n">the</span> <span class="n">header</span> <span class="n">file</span> <span class="p">....</span>
<span class="c1">//---------------------------------------------------------------------------</span>
<span class="c1">//</span>
<span class="c1">//                                3 Band EQ :)</span>
<span class="c1">//</span>
<span class="c1">// EQ.H - Header file for 3 band EQ</span>
<span class="c1">//</span>
<span class="c1">// (c) Neil C / Etanza Systems / 2K6</span>
<span class="c1">//</span>
<span class="c1">// Shouts / Loves / Moans = etanza at lycos dot co dot uk</span>
<span class="c1">//</span>
<span class="c1">// This work is hereby placed in the public domain for all purposes, including</span>
<span class="c1">// use in commercial applications.</span>
<span class="c1">//</span>
<span class="c1">// The author assumes NO RESPONSIBILITY for any problems caused by the use of</span>
<span class="c1">// this software.</span>
<span class="c1">//</span>
<span class="c1">//----------------------------------------------------------------------------</span>

<span class="cp">#ifndef __EQ3BAND__</span>
<span class="cp">#define __EQ3BAND__</span>


<span class="c1">// ------------</span>
<span class="c1">//| Structures |</span>
<span class="c1">// ------------</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
  <span class="c1">// Filter #1 (Low band)</span>

  <span class="kt">double</span>  <span class="n">lf</span><span class="p">;</span>       <span class="c1">// Frequency</span>
  <span class="kt">double</span>  <span class="n">f1p0</span><span class="p">;</span>     <span class="c1">// Poles ...</span>
  <span class="kt">double</span>  <span class="n">f1p1</span><span class="p">;</span>
  <span class="kt">double</span>  <span class="n">f1p2</span><span class="p">;</span>
  <span class="kt">double</span>  <span class="n">f1p3</span><span class="p">;</span>

  <span class="c1">// Filter #2 (High band)</span>

  <span class="kt">double</span>  <span class="n">hf</span><span class="p">;</span>       <span class="c1">// Frequency</span>
  <span class="kt">double</span>  <span class="n">f2p0</span><span class="p">;</span>     <span class="c1">// Poles ...</span>
  <span class="kt">double</span>  <span class="n">f2p1</span><span class="p">;</span>
  <span class="kt">double</span>  <span class="n">f2p2</span><span class="p">;</span>
  <span class="kt">double</span>  <span class="n">f2p3</span><span class="p">;</span>

  <span class="c1">// Sample history buffer</span>

  <span class="kt">double</span>  <span class="n">sdm1</span><span class="p">;</span>     <span class="c1">// Sample data minus 1</span>
  <span class="kt">double</span>  <span class="n">sdm2</span><span class="p">;</span>     <span class="c1">//                   2</span>
  <span class="kt">double</span>  <span class="n">sdm3</span><span class="p">;</span>     <span class="c1">//                   3</span>

  <span class="c1">// Gain Controls</span>

  <span class="kt">double</span>  <span class="n">lg</span><span class="p">;</span>       <span class="c1">// low  gain</span>
  <span class="kt">double</span>  <span class="n">mg</span><span class="p">;</span>       <span class="c1">// mid  gain</span>
  <span class="kt">double</span>  <span class="n">hg</span><span class="p">;</span>       <span class="c1">// high gain</span>

<span class="p">}</span> <span class="n">EQSTATE</span><span class="p">;</span>


<span class="c1">// ---------</span>
<span class="c1">//| Exports |</span>
<span class="c1">// ---------</span>

<span class="k">extern</span> <span class="kt">void</span>   <span class="nf">init_3band_state</span><span class="p">(</span><span class="n">EQSTATE</span><span class="o">*</span> <span class="n">es</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lowfreq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">highfreq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mixfreq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">double</span> <span class="nf">do_3band</span><span class="p">(</span><span class="n">EQSTATE</span><span class="o">*</span> <span class="n">es</span><span class="p">,</span> <span class="kt">double</span> <span class="n">sample</span><span class="p">);</span>


<span class="cp">#endif </span><span class="c1">// #ifndef __EQ3BAND__</span>
<span class="c1">//---------------------------------------------------------------------------</span>

<span class="n">Now</span> <span class="n">the</span> <span class="n">source</span> <span class="p">...</span>
<span class="c1">//----------------------------------------------------------------------------</span>
<span class="c1">//</span>
<span class="c1">//                                3 Band EQ :)</span>
<span class="c1">//</span>
<span class="c1">// EQ.C - Main Source file for 3 band EQ</span>
<span class="c1">//</span>
<span class="c1">// (c) Neil C / Etanza Systems / 2K6</span>
<span class="c1">//</span>
<span class="c1">// Shouts / Loves / Moans = etanza at lycos dot co dot uk</span>
<span class="c1">//</span>
<span class="c1">// This work is hereby placed in the public domain for all purposes, including</span>
<span class="c1">// use in commercial applications.</span>
<span class="c1">//</span>
<span class="c1">// The author assumes NO RESPONSIBILITY for any problems caused by the use of</span>
<span class="c1">// this software.</span>
<span class="c1">//</span>
<span class="c1">//----------------------------------------------------------------------------</span>

<span class="c1">// NOTES :</span>
<span class="c1">//</span>
<span class="c1">// - Original filter code by Paul Kellet (musicdsp.pdf)</span>
<span class="c1">//</span>
<span class="c1">// - Uses 4 first order filters in series, should give 24dB per octave</span>
<span class="c1">//</span>
<span class="c1">// - Now with P4 Denormal fix :)</span>


<span class="c1">//----------------------------------------------------------------------------</span>

<span class="c1">// ----------</span>
<span class="c1">//| Includes |</span>
<span class="c1">// ----------</span>

<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;eq.h&quot;</span><span class="cp"></span>


<span class="c1">// -----------</span>
<span class="c1">//| Constants |</span>
<span class="c1">// -----------</span>

<span class="k">static</span> <span class="kt">double</span> <span class="n">vsa</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">4294967295.0</span><span class="p">);</span>   <span class="c1">// Very small amount (Denormal Fix)</span>


<span class="c1">// ---------------</span>
<span class="c1">//| Initialise EQ |</span>
<span class="c1">// ---------------</span>

<span class="c1">// Recommended frequencies are ...</span>
<span class="c1">//</span>
<span class="c1">//  lowfreq  = 880  Hz</span>
<span class="c1">//  highfreq = 5000 Hz</span>
<span class="c1">//</span>
<span class="c1">// Set mixfreq to whatever rate your system is using (eg 48Khz)</span>

<span class="kt">void</span> <span class="nf">init_3band_state</span><span class="p">(</span><span class="n">EQSTATE</span><span class="o">*</span> <span class="n">es</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lowfreq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">highfreq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mixfreq</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Clear state</span>

  <span class="n">memset</span><span class="p">(</span><span class="n">es</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">EQSTATE</span><span class="p">));</span>

  <span class="c1">// Set Low/Mid/High gains to unity</span>

  <span class="n">es</span><span class="o">-&gt;</span><span class="n">lg</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">mg</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">hg</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

  <span class="c1">// Calculate filter cutoff frequencies</span>

  <span class="n">es</span><span class="o">-&gt;</span><span class="n">lf</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span> <span class="o">*</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">lowfreq</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">mixfreq</span><span class="p">));</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">hf</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">M_PI</span> <span class="o">*</span> <span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">highfreq</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">mixfreq</span><span class="p">));</span>
<span class="p">}</span>


<span class="c1">// ---------------</span>
<span class="c1">//| EQ one sample |</span>
<span class="c1">// ---------------</span>

<span class="c1">// - sample can be any range you like :)</span>
<span class="c1">//</span>
<span class="c1">// Note that the output will depend on the gain settings for each band</span>
<span class="c1">// (especially the bass) so may require clipping before output, but you</span>
<span class="c1">// knew that anyway :)</span>

<span class="kt">double</span> <span class="nf">do_3band</span><span class="p">(</span><span class="n">EQSTATE</span><span class="o">*</span> <span class="n">es</span><span class="p">,</span> <span class="kt">double</span> <span class="n">sample</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Locals</span>

  <span class="kt">double</span>  <span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">h</span><span class="p">;</span>      <span class="c1">// Low / Mid / High - Sample Values</span>

  <span class="c1">// Filter #1 (lowpass)</span>

  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p0</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">lf</span> <span class="o">*</span> <span class="p">(</span><span class="n">sample</span>   <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p0</span><span class="p">))</span> <span class="o">+</span> <span class="n">vsa</span><span class="p">;</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p1</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">lf</span> <span class="o">*</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p0</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p1</span><span class="p">));</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p2</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">lf</span> <span class="o">*</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p1</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p2</span><span class="p">));</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p3</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">lf</span> <span class="o">*</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p2</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p3</span><span class="p">));</span>

  <span class="n">l</span>          <span class="o">=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f1p3</span><span class="p">;</span>

  <span class="c1">// Filter #2 (highpass)</span>

  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p0</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">hf</span> <span class="o">*</span> <span class="p">(</span><span class="n">sample</span>   <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p0</span><span class="p">))</span> <span class="o">+</span> <span class="n">vsa</span><span class="p">;</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p1</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">hf</span> <span class="o">*</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p0</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p1</span><span class="p">));</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p2</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">hf</span> <span class="o">*</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p1</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p2</span><span class="p">));</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p3</span>  <span class="o">+=</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">hf</span> <span class="o">*</span> <span class="p">(</span><span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p2</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p3</span><span class="p">));</span>

  <span class="n">h</span>          <span class="o">=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm3</span> <span class="o">-</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">f2p3</span><span class="p">;</span>

  <span class="c1">// Calculate midrange (signal - (low + high))</span>

  <span class="n">m</span>          <span class="o">=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm3</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">l</span><span class="p">);</span>

  <span class="c1">// Scale, Combine and store</span>

  <span class="n">l</span>         <span class="o">*=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">lg</span><span class="p">;</span>
  <span class="n">m</span>         <span class="o">*=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">mg</span><span class="p">;</span>
  <span class="n">h</span>         <span class="o">*=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">hg</span><span class="p">;</span>

  <span class="c1">// Shuffle history buffer</span>

  <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm3</span>   <span class="o">=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm2</span><span class="p">;</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm2</span>   <span class="o">=</span> <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm1</span><span class="p">;</span>
  <span class="n">es</span><span class="o">-&gt;</span><span class="n">sdm1</span>   <span class="o">=</span> <span class="n">sample</span><span class="p">;</span>

  <span class="c1">// Return result</span>

  <span class="k">return</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="n">h</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">//----------------------------------------------------------------------------</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-03-28 03:33:04</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;mot&#37;&#52;&#48;lx_iruy">moc<span>&#46;</span>mot<span>&#64;</span>lx_iruy</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Great Thanks!
I have one problem the below:
  double  f2p0;     // Poles ...
  double  f2p1;
  double  f2p2;
  double  f2p3;
that I want to know the starting value
about f2p0,f2p1,...!
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-04-14 12:02:27</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;knuf_red_retavttog_nuarb_semaj">moc<span>&#46;</span>oohay<span>&#64;</span>knuf_red_retavttog_nuarb_semaj</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>yuri:

The invocation of memset() during the initialization method sets all the the members of the struct to zero.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-05-22 19:05:47</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamtoh&#37;&#52;&#48;cnamlleh">moc<span>&#46;</span>liamtoh<span>&#64;</span>cnamlleh</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This is great -- I want to develop a compressor/limiter/expander and have been looking long and hard for bandpass / eq filtering code.  Here it is!

I am sure we could easily expand this into an x band eq.

Thanks!
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-07-05 06:49:45</p></li>
<li><p><strong>By</strong>: tom tom</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hi !

I&#39;ve just transposed your code under Delphi.

It works well if the gain is under 1, but if i put gain &gt; 1 i get clipping (annoying sound clips), even at 1.1;

Is it normal ?

I convert my smallint (44100 16 bits) to double before process, and convert the obtained value back to smallint with clipping (if &lt; -32768 i set it to -32768, and if &gt; 32768 i set it to 32768).

What did i do wrong ?

Regards

Tom
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-07-21 14:24:53</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ed&#46;xmg&#37;&#52;&#48;7trebreh">ed<span>&#46;</span>xmg<span>&#64;</span>7trebreh</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hi.

Maybe the answer is quite easy. The upper limit is 32767 not 32768.

Regards

Herbert
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2007-08-23 02:39:23</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;3617100aggna">moc<span>&#46;</span>oohay<span>&#64;</span>3617100aggna</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hi, Can U send me a full source code for this 3 band state eq from start to end ??
Please !!!!
I really need it for my study in school.
I hope you can send me, to my email.

thanks you.
regard


angga
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-05-05 16:37:21</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;2156niahv">moc<span>&#46;</span>liamg<span>&#64;</span>2156niahv</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>How can I expand this 3 Band EQ into X Band EQ..?!

Anybody answer me, or email me..
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-05-22 13:27:00</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;boohay&#37;&#52;&#48;bob">moc<span>&#46;</span>boohay<span>&#64;</span>bob</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>For more bands, you could take the low-pass and repeat the process on that.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-05-23 18:46:04</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;yabtsalb&#37;&#52;&#48;pilihp">moc<span>&#46;</span>yabtsalb<span>&#64;</span>pilihp</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This is a great little filter, I am using it in an application but when I first started playing with it I noticed some problems. The mid range didn&#39;t seem to be calculated properly, a friend of mine who knows more about dsp than I do took a quick look at it and suggested the following change:

  m          = es-&gt;sdm3 - (h + l);

Should be:

  m          = sample - (h + l);

I&#39;ve tested it with this small fix and everything works perfectly now. Just thought I&#39;d bring this to your attention... Thanks for a great code snippet!
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-05-24 15:27:11</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;boohay&#37;&#52;&#48;bob">moc<span>&#46;</span>boohay<span>&#64;</span>bob</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>What problems were you getting? Doesn&#39;t removing the delay cause phase problems?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2009-06-25 10:34:44</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;limagy&#37;&#52;&#48;ec&#46;rahceb">moc<span>&#46;</span>limagy<span>&#64;</span>ec<span>&#46;</span>rahceb</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Hi Great Stuff,

how to create 6 band equalizer, is any algorithm for 6 band same like 3 band, please help me if any one

thanks in advance
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2010-05-06 20:21:20</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;anesejiw">moc<span>&#46;</span>liamg<span>&#64;</span>anesejiw</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>How to extend this to 6 band equalizer?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2010-05-27 21:45:44</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamtoh&#37;&#52;&#48;aanaibas_nairam">moc<span>&#46;</span>liamtoh<span>&#64;</span>aanaibas_nairam</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>hello! thanks for your code!!
i tried to use the code in my project of guitar distortions in real time (in C) and i could&#39;nt, i&#39;m in linux using jack audio server, and it starts to have x-runs everytime i turn on the equalizer. do you any idea of how solving this? (from 5 to 50 milliseconds o x-runs)
i was thinking of coding it in assembler but i don&#39;t know if that would be the solution.
excuse me for my english, i&#39;m from argentina and it&#39;s been a while since i last wrote in this language!
thanks in advance, hoping to see any answer!
mariano
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2010-11-03 14:19:25</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;oohay&#37;&#52;&#48;56_drow">moc<span>&#46;</span>oohay<span>&#64;</span>56_drow</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Dev c++ can not run it? any suggesstions, how to run it?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2011-02-23 13:24:53</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;kniniurb&#46;tnecniv">moc<span>&#46;</span>liamg<span>&#64;</span>kniniurb<span>&#46;</span>tnecniv</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This example is exactly what i&#39;ve been looking for. This little piece of code executes faster then the one I have been using before.

FYI,

I will use the code in a 3 band compressor / limiter / clipper for FM broadcasting.

Thanks for sharing.

Best regards,

Vincent Bruinink.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2011-03-21 18:03:15</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;liamtsil&#46;mtp">moc<span>&#46;</span>liamg<span>&#64;</span>liamtsil<span>&#46;</span>mtp</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I&#39;ve got this filtering audio on iOS by running my sample through do_3band in the render callback. However, I&#39;m getting a fair amount of distortion. Here&#39;s an example with my EQ3Band gains all set to 1.0:

http://www.youtube.com/watch?v=W_6JaNUvUjA

Here&#39;s the code for my implementation:

https://github.com/tassock/mixerhost/commit/4b8b87028bfffe352ed67609f747858059a3e89b

I assume others using this aren&#39;t having this same distortion issue? If so, what sort of audio sample formats are you using (big/little endian, float/integer samples, etc). Thanks!
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2011-04-30 20:17:58</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;enohpi&#46;senarab">moc<span>&#46;</span>liamg<span>&#64;</span>enohpi<span>&#46;</span>senarab</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>hi,
I got also distorsion even though my all my gains are set to 1. Please help

Lucie
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2012-06-05 07:19:56</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;solbaidcod">moc<span>&#46;</span>liamg<span>&#64;</span>solbaidcod</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>      I&#39;ve made an implementation of 3 band Equalizer to read a wave file,apply filtering and then save wave  outputfile.
With your code I have a lot of distortion,I think the problem maybe coefficient calculation:

es-&gt;f1p0  += (es-&gt;lf * (sample   - es-&gt;f1p0))+vsa ;
  ...



Can anyone resolve distortion?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-01-11 16:43:12</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:es&#46;dnargvelk&#37;&#52;&#48;nahoj">es<span>&#46;</span>dnargvelk<span>&#64;</span>nahoj</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Works fine for me on iOS. Maybe you feed a interleaved stereo signal with the same EQSTATE instance (you&#39;ll need one EQSTATE for each channel)?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-04-07 17:50:46</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ta&#46;erehthgir&#37;&#52;&#48;liameon">ta<span>&#46;</span>erehthgir<span>&#64;</span>liameon</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>It&#39;s all about WHERE you init you EQ.  Try a little :) If you don&#39;t find out yourself, I&#39;ll help you.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-06-18 14:00:45</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;laimtoh&#37;&#52;&#48;inaam_riamu">moc<span>&#46;</span>laimtoh<span>&#64;</span>inaam_riamu</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I added this code to my xcode project. But where i can pass the values and method. May be its funny question for you guyz but please help me. Its loking good to me but in xcode , i am using avaudio player for play sound and making sound app.
Thanks
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-07-01 23:07:05</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;iaznabi">moc<span>&#46;</span>liamg<span>&#64;</span>iaznabi</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>The distortion will occur of you are trying to adapt this to stereo and do so by simply adding an outer loop per channel. Doing so will cause the filter values to compound and cause distortion. Instead, you will need to duplicate all the filter values and keep them separate from the other channel.
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2013-08-21 14:09:08</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:moc&#46;liamg&#37;&#52;&#48;nurb&#46;luap">moc<span>&#46;</span>liamg<span>&#64;</span>nurb<span>&#46;</span>luap</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Any good x-band equalizer equivalents for C# that I can use?
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2014-08-05 22:57:07</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:ed&#46;xmg&#37;&#52;&#48;retsneum&#46;ellak">ed<span>&#46;</span>xmg<span>&#64;</span>retsneum<span>&#46;</span>ellak</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>s&#39;cool thanks!
have portet to c#
works fine!
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Date</strong>: 2015-09-28 07:53:37</p></li>
<li><p><strong>By</strong>: <a class="reference external" href="mailto:az&#46;oc&#46;sseccadipar&#37;&#52;&#48;sook">az<span>&#46;</span>oc<span>&#46;</span>sseccadipar<span>&#64;</span>sook</a></p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Converted Neil&#39;s C Code 3 band equalizer to Delphi class, for those who are interested.


1. Create instance of class
   Public
     eq:TEQ;

2. On form create

    eq := TEq.Create;

    //Initialize
    init_3band_state(880,5000,44100,50,-25,0);

    //init_3band_state(lowfreq,highfreq,mixfreq:integer;BassGain,MidGain,HighGain:Double);


3. process: pass Raw 16Bit PCM to eq

eq.Equalize(const Data: Pointer; DataSize: DWORD);

Works like a charm form me

***********************************************
  TEq=Class
  private
    lf,f1p0,f1p1,f1p2,f1p3:double;
    hf,f2p0,f2p1,f2p2,f2p3:double;
    sdm1,sdm2,sdm3:double;
    vsa:double;
    lg,mg,hg:double;
    Function do_3band(sample:Smallint):Smallint;
  public
    constructor create;
    destructor destroy;override;
    procedure init_3band_state(lowfreq,highfreq,mixfreq:integer;BassGain,MidGain,HighGain:Double);
    procedure Equalize(const Data: Pointer; DataSize: DWORD);
  end;


constructor TEQ.create;
begin
  inherited create;
  vsa := (1.0 / 4294967295.0);
  lg := 1.0;
  mg := 1.0;
  hg := 1.0;

end;


destructor TEQ.destroy;
begin
  inherited destroy;
end;

procedure TEQ.init_3band_state(lowfreq,highfreq,mixfreq:integer;BassGain,MidGain,HighGain:Double);
begin

 {(880,5000,44100,1.5,0.75,1.0)
 eq.lg = 1.5; // Boost bass by 50%
 eq.mg = 0.75; // Cut mid by 25%
 eq.hg = 1.0; // Leave high band alone }

 lg := 1+(BassGain/100);
 mg := 1+(MidGain/100);
 hg := 1+(HighGain/100);

// Calculate filter cutoff frequencies

 lf := 2 * sin(PI * (lowfreq / mixfreq));
 hf := 2 * sin(PI * (highfreq / mixfreq));
end;

Function TEQ.do_3band(sample:Smallint):Smallint;
var l,m,h:double;
    res:integer;
begin

// Filter #1 (lowpass)

  f1p0 := f1p0 + (lf * (sample - f1p0)) + vsa;
  f1p1 := f1p1 + (lf * (f1p0 - f1p1));
  f1p2 := f1p2 + (lf * (f1p1 - f1p2));
  f1p3 := f1p3 + (lf * (f1p2 - f1p3));

  l := f1p3;

// Filter #2 (highpass)

  f2p0 := f2p0 + (hf * (sample - f2p0)) + vsa;
  f2p1 := f2p1 + (hf * (f2p0 - f2p1));
  f2p2 := f2p2 + (hf * (f2p1 - f2p2));
  f2p3 := f2p3 + (hf * (f2p2 - f2p3));

  h := sdm3 - f2p3;

// Calculate midrange (signal - (low + high))

  m := sdm3 - (h + l);

// Scale, Combine and store

  l := l * lg;
  m := m * mg;
  h := h * hg;

// Shuffle history buffer

  sdm3 := sdm2;
  sdm2 := sdm1;
  sdm1 := sample;

// Return result
  res := trunc(l+m+h);
  if res &gt; 32767 then res := 32767 else if res &lt; -32768 then res := -32768;

  result := res;
end;

procedure TEQ.Equalize(const Data: Pointer; DataSize: DWORD);
var pSample: PSmallInt;
begin
  pSample := Data;
  while DataSize &gt; 0 do
  begin
    pSample^ := do_3band(pSample^);
    Inc(pSample);
    Dec(DataSize, 2);
  end;
end;
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="30-303-type-filter-with-saturation.html" class="btn btn-neutral float-right" title="303 type filter with saturation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="85-1st-and-2nd-order-pink-noise-filters.html" class="btn btn-neutral float-left" title="1st and 2nd order pink noise filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Too many to list

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>